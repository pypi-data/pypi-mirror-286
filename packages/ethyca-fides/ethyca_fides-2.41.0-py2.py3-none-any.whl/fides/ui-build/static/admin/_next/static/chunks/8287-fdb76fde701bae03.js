"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8287],{38287:function(e,t,i){i.d(t,{Z:function(){return M}});var a,n=i(85034),s=i(31373),r=i(24246),o=i(86702),l=i(83265),d=i(27378),u=i(95241),c=i(23842),m=i(70169),p=i(52050),h=i(3204),f=i(85556),v=i(32556),x=i(61186),y=i(44982),b=i(34038),g=i(34090),j=i(76738),_=i(28067),k=i(16310),D=i(56071),S=i(10439),C=k.Ry().shape({data_categories:k.IX(k.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:k.Z_().required().label("Data use"),data_subjects:k.IX(k.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),Z={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:"",cookies:[]},w=function(e){var t,i=e.allDataUses,a=e.allDataCategories,n=e.allDataSubjects,s=e.allDatasets,o=e.privacyDeclarationId,d=e.includeCookies,u=e.includeCustomFields,c=s?s.map((function(e){return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}})):[];return(0,r.jsxs)(l.Kqy,{spacing:4,children:[(0,r.jsx)(D.AP,{id:"data_use",label:"Data use",name:"data_use",options:i.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",variant:"stacked",singleValueBlock:!0,isDisabled:!!o}),(0,r.jsx)(D.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!o}),(0,r.jsx)(D.AP,{name:"data_categories",label:"Data categories",options:a.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",isMulti:!0,variant:"stacked",isDisabled:!0}),(0,r.jsx)(D.AP,{name:"data_subjects",label:"Data subjects",options:n.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",isMulti:!0,variant:"stacked",isDisabled:!0}),d?(0,r.jsx)(D.VT,{name:"cookies",label:"Cookies",options:[],isMulti:!0,variant:"stacked",isClearable:!1}):null,s?(0,r.jsx)(D.AP,{name:"dataset_references",label:"Dataset references",options:c,tooltip:"Referenced Dataset fides keys used by the system.",isMulti:!0,variant:"stacked"}):null,u?(0,r.jsx)(_.uc,{resourceType:S.P6.PRIVACY_DECLARATION,resourceFidesKey:o}):null]})},V=function(e,t){var i;return e?(0,m.Z)((0,n.Z)({},e),{customFieldValues:t||{},cookies:null!==(a=null===(i=e.cookies)||void 0===i?void 0:i.map((function(e){return e.name})))&&void 0!==a?a:[]}):Z},I=function(e){var t=e.onSubmit,i=e.initialValues,a=e.allDataUses,o=e.privacyDeclarationId,u=(0,_.mZ)({resourceType:S.P6.PRIVACY_DECLARATION,resourceFidesKey:o}),p=u.customFieldValues,h=u.upsertCustomFields,v=(0,d.useMemo)((function(){return V(i,p)}),[i,p]),x=(0,d.useState)(!1),y=x[0],b=x[1],g=(0,d.useMemo)((function(){var e=a.filter((function(e){return e.fides_key===v.data_use}))[0];if(e)return v.name?"".concat(e.name," - ").concat(v.name):e.name}),[a,v]),j=function(){var e=(0,c.Z)((function(e,i){var a,r,o,l;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:return a=e.customFieldValues,r=function(e){e.customFieldValues;var t,i=(0,s.Z)(e,["customFieldValues"]);return(0,m.Z)((0,n.Z)({},i),{name:null!==(t=e.name)&&void 0!==t?t:"",cookies:i.cookies.map((function(e){return{name:e,path:"/"}}))})}(e),[4,t(r,i)];case 1:return(o=d.sent())?(l=o.filter((function(t){return t.data_use===e.data_use&&(!t.name||t.name===e.name)}))).length>0?[4,h({customFieldValues:a,fides_key:l[0].id})]:[3,3]:[3,4];case 2:d.sent(),d.label=3;case 3:i.resetForm({values:e}),b(!0),d.label=4;case 4:return[2]}}))}));return function(t,i){return e.apply(this,arguments)}}();return{handleSubmit:j,renderHeader:function(e){var t=e.dirty,i=e.boxProps,a=e.hideSaved;return(0,r.jsxs)(l.xuv,(0,m.Z)((0,n.Z)({display:"flex",alignItems:"center",justifyContent:"space-between"},i),{children:[g?(0,r.jsx)(l.X6q,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:g}):null,!a&&y&&!t&&v.data_use?(0,r.jsxs)(l.xvT,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,r.jsx)(l.StI,{})," Saved"]}):null]}))},initialValues:v}},F=function(e){var t=e.onSubmit,i=e.initialValues,a=e.onDelete,o=(0,s.Z)(e,["onSubmit","initialValues","onDelete"]),d=I({onSubmit:t,initialValues:i,allDataUses:o.allDataUses,privacyDeclarationId:null===i||void 0===i?void 0:i.id}),u=d.handleSubmit,c=d.renderHeader,m=d.initialValues;return(0,r.jsx)(g.J9,{enableReinitialize:!0,initialValues:m,onSubmit:u,validationSchema:C,children:function(e){var t=e.dirty;return(0,r.jsxs)(g.l0,{children:[(0,r.jsx)(j.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,r.jsxs)(l.Kqy,{spacing:4,children:[(0,r.jsx)(l.xuv,{"data-testid":"header",children:c({dirty:t})}),(0,r.jsx)(w,(0,n.Z)({onDelete:a},o))]})]})}})},T=function(e){var t=e.privacyDeclaration,i=e.onEdit,a=e.onDelete,o=e.includeCustomFields,d=e.includeCookies,u=(0,s.Z)(e,["privacyDeclaration","onEdit","onDelete","includeCustomFields","includeCookies"]),c=I((0,n.Z)({initialValues:t,onSubmit:function(e){return i(t,e)},privacyDeclarationId:t.id},u)),m=c.initialValues,p=c.renderHeader,h=c.handleSubmit;return(0,r.jsx)(l.Qdk,{children:function(e){var i=e.isExpanded;return(0,r.jsx)(g.J9,{enableReinitialize:!0,initialValues:m,onSubmit:h,validationSchema:C,children:function(e){var s=e.dirty;return(0,r.jsxs)(g.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,r.jsx)(j.Gt,{id:"".concat(t.id,"-form"),name:t.id}),(0,r.jsxs)(l.KFZ,{py:4,borderBottomWidth:i?"0px":"1px",backgroundColor:i?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[p({dirty:s,boxProps:{flex:"1",textAlign:"left"},hideSaved:!i}),(0,r.jsx)(l.XEm,{})]}),(0,r.jsx)(l.Hk3,{backgroundColor:"gray.50",pt:0,children:(0,r.jsx)(l.Kqy,{spacing:4,children:(0,r.jsx)(w,(0,n.Z)({privacyDeclarationId:t.id,onDelete:a,includeCustomFields:o,includeCookies:d},u))})})]})}})}})},P=function(e){var t=e.privacyDeclarations,i=(0,s.Z)(e,["privacyDeclarations"]);return(0,r.jsx)(l.UQy,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map((function(e){return(0,r.jsx)(T,(0,n.Z)({privacyDeclaration:e},i),e.id)}))})},A=function(e){var t=e.system,i=(e.addButtonProps,e.includeCustomFields),a=e.includeCookies,o=e.onSave,u=(0,s.Z)(e,["system","addButtonProps","includeCustomFields","includeCookies","onSave"]),g=(0,l.pmc)(),j=(0,p.Z)((0,y.qQ)(),1)[0],_=(0,d.useState)(!1),k=_[0],D=_[1],S=(0,d.useState)(void 0),C=S[0],Z=S[1],w=(0,d.useMemo)((function(){return C?t.privacy_declarations.filter((function(e){return e.id!==C.id})):t.privacy_declarations}),[C,t]),V=function(e){return w.filter((function(t){return t.data_use===e.data_use&&t.name===e.name})).length>0&&(g((0,x.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0)},I=function(){var e=(0,c.Z)((function(e,i){var a,s,r,l,d;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return s=e.map((function(e){return(0,m.Z)((0,n.Z)({},e),{name:null!==(a=e.name)&&void 0!==a?a:""})})),r=(0,m.Z)((0,n.Z)({},t),{privacy_declarations:s}),l=function(e){if(!(0,b.D4)(e))return g.closeAll(),g((0,x.t5)(i?"Data use deleted":"Data use saved")),o&&o(e.data),e.data.privacy_declarations;var t=(0,v.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");g((0,x.Vo)(t))},[4,j(r)];case 1:return d=u.sent(),[2,l(d)]}}))}));return function(t,i){return e.apply(this,arguments)}}(),T=function(){var e=(0,c.Z)((function(e,i){var a;return(0,f.__generator)(this,(function(n){return i.id!==e.id&&V(i)?[2,void 0]:(a=t.privacy_declarations.map((function(t){return t.id===e.id?i:t})),[2,I(a)])}))}));return function(t,i){return e.apply(this,arguments)}}(),A=function(){var e=(0,c.Z)((function(e){var t,i,a;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return V(e)?[2,void 0]:(g.closeAll(),t=(0,h.Z)(w).concat([e]),[4,I(t)]);case 1:return(i=n.sent())&&(a=i.filter((function(t){return(!t.name||t.name===e.name)&&t.data_use===e.data_use}))[0],Z(a)),[2,i]}}))}));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=(0,c.Z)((function(e){var i;return(0,f.__generator)(this,(function(a){return i=t.privacy_declarations.filter((function(t){return t.id!==e.id})),[2,I(i,!0)]}))}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,c.Z)((function(e){var t;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return[4,z(e)];case 1:return(t=i.sent())&&(D(!1),Z(void 0)),[2,t]}}))}));return function(t){return e.apply(this,arguments)}}();return(0,d.useEffect)((function(){D(!1)}),[t.fides_key]),(0,r.jsxs)(l.Kqy,{spacing:3,children:[(0,r.jsx)(P,(0,n.Z)({privacyDeclarations:w,onEdit:T,onDelete:z,includeCustomFields:i,includeCookies:a},u)),k?(0,r.jsx)(l.xuv,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,r.jsx)(F,(0,n.Z)({initialValues:C,onSubmit:A,onDelete:E,includeCustomFields:i,includeCookies:a},u))}):null,0===t.privacy_declarations.length?(0,r.jsx)(l.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},z=i(32764),E={name:"",description:""},W=function(e){var t=e.system,i="/systems/configure/".concat(t.fides_key),a=function(e){var t=(0,p.Z)((0,y.dB)(),1)[0],i=(0,l.pmc)(),a=function(){var a=(0,c.Z)((function(a,s){var r,o;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return r=[(0,m.Z)((0,n.Z)({},e),{name:a.name,description:a.description})],[4,t(r)];case 1:return o=l.sent(),(0,z.D4)(o)?i((0,x.Vo)((0,v.e$)(o.error))):(i((0,x.t5)("Successfully saved system info")),s.resetForm({values:a})),[2]}}))}));return function(e,t){return a.apply(this,arguments)}}();return{handleUpsertSystem:a,validationSchema:k.Ry().shape({name:k.Z_().required().label("Name"),description:k.Z_().required().label("Description")})}}(t),s=a.handleUpsertSystem,o=a.validationSchema;return(0,r.jsxs)(l.xuv,{children:[(0,r.jsxs)(l.kCb,{alignItems:"center",children:[(0,r.jsx)(l.xvT,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,r.jsx)(l.LZC,{}),(0,r.jsxs)(l._pl,{color:"complimentary.500",href:i,children:["View more",(0,r.jsx)(l.h0n,{ml:2})]})]}),(0,r.jsx)(l.xuv,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,r.jsx)(g.J9,{enableReinitialize:!0,initialValues:null!==t&&void 0!==t?t:E,validationSchema:o,onSubmit:s,children:function(e){var t=e.isSubmitting,i=e.dirty,a=e.isValid;return(0,r.jsxs)(g.l0,{children:[(0,r.jsx)(j.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,r.jsx)(l.xuv,{marginTop:3,children:(0,r.jsx)(D.j0,{label:"System name",name:"name",variant:"stacked"})}),(0,r.jsx)(l.xuv,{marginTop:3,children:(0,r.jsx)(D.Ks,{label:"System Description",name:"description",variant:"stacked"})}),(0,r.jsx)(l.kCb,{marginTop:6,justifyContent:"flex-end",children:(0,r.jsx)(l.zxk,{textAlign:"right",type:"submit",isDisabled:!i||!a,colorScheme:"primary",isLoading:t,size:"sm",children:"Save"})})]})}})})]})},M=function(e){var t,i=e.selectedSystemId,a=e.resetSelectedSystemId,c=(0,d.useMemo)((function(){return Boolean(i)}),[i]),m=(0,u.f)({includeDatasets:!1,includeDisabled:!1}),p=(m.isLoading,(0,s.Z)(m,["isLoading"])),h=(0,y.rn)(i,{skip:!i}).data;return(0,r.jsx)(l.xuv,{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,overflow:"hidden",children:(0,r.jsx)(l.Mi4,{transition:{enter:{ease:"easeInOut",duration:.5},exit:{ease:"easeInOut",duration:.5}},direction:"right",in:c,unmountOnExit:!0,style:{zIndex:11,pointerEvents:"none",position:"absolute"},children:(0,r.jsxs)(l.xuv,{position:"absolute",right:"0px",height:"100%",width:"100%",maxWidth:"480px",pointerEvents:"auto",borderWidth:0,boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)",display:i?"unset":"none",backgroundColor:"white","data-testid":"datamap-drawer",children:[(0,r.jsx)(l.xuv,{id:"drawer-header",borderBottomWidth:1,paddingX:6,paddingY:3,children:(0,r.jsxs)(l.kCb,{children:[(0,r.jsx)(l.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:(0,r.jsx)(l.xvT,{fontWeight:"semibold",fontSize:"lg",lineHeight:"7",color:"gray.900",children:null!==(t=null===h||void 0===h?void 0:h.name)&&void 0!==t?t:"System Information"})}),(0,r.jsx)(l.LZC,{}),(0,r.jsx)(l.kCb,{alignItems:"center",children:(0,r.jsx)(l.hU,{icon:(0,r.jsx)(l.Two,{}),"aria-label":"Close error message",size:"sm",style:{height:"24px",width:"24px",minWidth:"14px",backgroundColor:"#00000000"},onClick:a,"data-testid":"datamap-drawer-close"})})]})}),(0,r.jsx)(l.xuv,{id:"drawer-body",height:"calc(100% - 46px)",overflowY:"auto",padding:6,style:{scrollbarGutter:"stable"},children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W,{system:h}),(0,r.jsx)(l.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,r.jsx)(l.xuv,{borderTop:"1px solid",borderColor:"gray.200",children:(0,r.jsx)(l.xuv,{pb:3,children:(0,r.jsx)(A,(0,n.Z)({system:h,addButtonProps:{ml:4}},p))})}),(0,r.jsx)(l.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,r.jsx)(o.q,{system:h})]}):null})]})})})}}}]);