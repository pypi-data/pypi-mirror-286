(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2815],{24081:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/messaging",function(){return n(3714)}])},25010:function(e,t,n){"use strict";var i=n(85034),s=n(70169),r=n(24246),a=n(83265),o=n(88038),u=n.n(o);n(27378);t.Z=function(e){var t=e.children,n=e.title,o=e.mainProps;return(0,r.jsxs)(a.kCb,{"data-testid":n,direction:"column",height:"calc(100vh - 48px)",width:"calc(100vw - 200px)",children:[(0,r.jsxs)(u(),{children:[(0,r.jsxs)("title",{children:["Fides Admin UI - ",n]}),(0,r.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)(a.kCb,(0,s.Z)((0,i.Z)({pt:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0},o),{children:t}))]})}},66081:function(e,t,n){"use strict";var i=n(24246),s=n(83265);t.Z=function(e){var t=e.title,n=e.text,r=e.onClose;return(0,i.jsxs)(s.Ugi,{backgroundColor:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",py:4,pr:6,pl:3,"data-testid":"empty-state",gap:2,position:"relative",children:[r&&(0,i.jsx)(s.Two,{boxSize:5,position:"absolute",right:3,top:3,zIndex:1,cursor:"pointer",p:1,onClick:r}),(0,i.jsx)(s.iid,{alignSelf:"start",color:"blue.400",mt:.5,flexGrow:0}),(0,i.jsxs)(s.kCb,{direction:"column",gap:2,flexGrow:1,children:[(0,i.jsx)(s.X6q,{fontSize:"md",children:t}),(0,i.jsx)(s.xvT,{fontSize:"sm",color:"gray.600",lineHeight:"5",children:n})]})]})}},87594:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var i=n(85034),s=n(70169),r=n(31373),a=n(24246),o=n(83265),u=n(98784),c=n(27378),l=n(79894),d=n.n(l),g=function(e){var t=e.breadcrumbs;return(0,a.jsx)(o.aGc,{separator:"->",fontSize:"2xl",fontWeight:"semibold","data-testid":"breadcrumbs",children:t.map((function(e,n){var i=n+1===t.length,s=!!e.link||!!e.onClick;return(0,a.jsx)(o.gN6,{color:i||e.isOpaque?"black":"gray.500",children:s?(0,a.jsx)(o.Atw,{as:d(),href:e.link,isCurrentPage:i,children:e.title}):(0,a.jsx)(o.Atw,{_hover:{textDecoration:"none",cursor:"default"},isCurrentPage:i,children:e.title})},e.title)}))})},m=function(e){var t=e.breadcrumbs,n=e.isSticky,l=void 0===n||n,d=e.children,m=(0,r.Z)(e,["breadcrumbs","isSticky","children"]);return(0,a.jsxs)(o.xuv,(0,s.Z)((0,i.Z)({bgColor:"white",paddingY:5},l?{position:"sticky",top:0,left:0,zIndex:10}:{},m),{children:[(0,u.isArray)(t)&&(0,a.jsx)(o.xuv,{marginBottom:d?4:0,children:(0,a.jsx)(g,{breadcrumbs:t})}),(0,c.isValidElement)(t)&&t,d]}))}},10437:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i,s,r=n(17599);!function(e){e.PRIVACY_REQUEST_REVIEW_APPROVE="privacy_request_review_approve",e.PRIVACY_REQUEST_REVIEW_DENY="privacy_request_review_deny",e.PRIVACY_REQUEST_RECEIPT="privacy_request_receipt",e.PRIVACY_REQUEST_COMPLETE_ACCESS="privacy_request_complete_access",e.PRIVACY_REQUEST_COMPLETE_DELETION="privacy_request_complete_deletion",e.SUBJECT_IDENTITY_VERIFICATION="subject_identity_verification"}(i||(i={}));var a=(s={},(0,r.Z)(s,i.PRIVACY_REQUEST_COMPLETE_ACCESS,"Access request completed"),(0,r.Z)(s,i.PRIVACY_REQUEST_COMPLETE_DELETION,"Erasure request completed"),(0,r.Z)(s,i.PRIVACY_REQUEST_RECEIPT,"Privacy request received"),(0,r.Z)(s,i.PRIVACY_REQUEST_REVIEW_APPROVE,"Privacy request approved"),(0,r.Z)(s,i.PRIVACY_REQUEST_REVIEW_DENY,"Privacy request denied"),(0,r.Z)(s,i.SUBJECT_IDENTITY_VERIFICATION,"Subject identity verification"),s)},82026:function(e,t,n){"use strict";n.d(t,{KC:function(){return c},Vw:function(){return l},ew:function(){return d},gQ:function(){return o},jM:function(){return s},lE:function(){return r},ms:function(){return a},pS:function(){return u},vm:function(){return g}});var i=n(85768).u.injectEndpoints({endpoints:function(e){return{getMessagingTemplates:e.query({query:function(){return{url:"messaging/templates"}},providesTags:function(){return["Messaging Templates"]}}),getSummaryMessagingTemplates:e.query({query:function(e){return{method:"GET",url:"messaging/templates/summary",params:e}},providesTags:function(){return["Property-Specific Messaging Templates"]}}),updateMessagingTemplates:e.mutation({query:function(e){return{url:"messaging/templates",method:"PUT",body:e}},invalidatesTags:function(){return["Property-Specific Messaging Templates"]}}),getMessagingTemplateById:e.query({query:function(e){return{url:"/messaging/templates/".concat(e)}},providesTags:function(){return["Property-Specific Messaging Templates"]}}),putMessagingTemplateById:e.mutation({query:function(e){var t=e.templateId,n=e.template;return{url:"/messaging/templates/".concat(t),method:"PUT",body:n}},invalidatesTags:function(){return["Property-Specific Messaging Templates"]}}),patchMessagingTemplateById:e.mutation({query:function(e){var t=e.templateId,n=e.template;return{url:"/messaging/templates/".concat(t),method:"PATCH",body:n}},invalidatesTags:function(){return["Property-Specific Messaging Templates"]}}),getMessagingTemplateDefault:e.query({query:function(e){return{url:"/messaging/templates/default/".concat(e)}}}),createMessagingTemplateByType:e.mutation({query:function(e){var t=e.templateType,n=e.template;return{url:"/messaging/templates/".concat(t),method:"POST",body:n}},invalidatesTags:function(){return["Property-Specific Messaging Templates"]}}),deleteMessagingTemplateById:e.mutation({query:function(e){return{url:"/messaging/templates/".concat(e),method:"DELETE"}},invalidatesTags:function(){return["Property-Specific Messaging Templates"]}})}}}),s=i.useGetMessagingTemplatesQuery,r=i.useUpdateMessagingTemplatesMutation,a=i.useGetSummaryMessagingTemplatesQuery,o=i.useGetMessagingTemplateByIdQuery,u=i.usePutMessagingTemplateByIdMutation,c=i.useGetMessagingTemplateDefaultQuery,l=i.useCreateMessagingTemplateByTypeMutation,d=i.useDeleteMessagingTemplateByIdMutation,g=i.usePatchMessagingTemplateByIdMutation},3714:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var i=n(23842),s=n(85034),r=n(52050),a=n(85556),o=n(24246),u=n(92222),c=n(59003),l=n(83265),d=n(98784),g=n(86677),m=n(27378),p=n(25010),f=n(70885),h=n(66081),x=n(93677),v=n(87594),y=n(12934),T=n(73659),b=n(74618),E=n(69883),_=n(56071),j=n(10437),C=function(e){var t=e.isOpen,n=e.onClose,i=e.onAccept,s=(0,m.useState)(void 0),r=s[0],a=s[1],u=Object.keys(j.Z).map((function(e){return{value:e,label:j.Z[e]}}));return(0,o.jsxs)(l.u_l,{isOpen:t,onClose:n,size:"2xl",isCentered:!0,children:[(0,o.jsx)(l.ZAr,{}),(0,o.jsxs)(l.hzk,{"data-testid":"add-messaging-template-modal",children:[(0,o.jsx)(l.xBx,{borderBottomWidth:1,fontWeight:"bold",children:"Select message template"}),(0,o.jsxs)(l.fef,{children:[(0,o.jsx)(l.xvT,{color:"gray.700",fontWeight:"medium",fontSize:"sm",marginBottom:3,marginTop:1,children:"Add a new email message by selecting a template below and clicking accept."}),(0,o.jsx)(l.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"medium",marginBottom:2,children:"Choose template:"}),(0,o.jsx)(l.xuv,{"data-testid":"template-type-selector",children:(0,o.jsx)(E.Z,{options:u,size:"sm",chakraStyles:_.hP,onChange:function(e){a(null===e||void 0===e?void 0:e.value)},classNamePrefix:"custom-select"})})]}),(0,o.jsx)(l.mzw,{justifyContent:"flex-start",children:(0,o.jsxs)(l.hE2,{size:"sm",display:"flex",justifyItems:"stretch",w:"full",children:[(0,o.jsx)(l.zxk,{variant:"outline",mr:2,onClick:n,"data-testid":"cancel-btn",size:"md",flex:1,children:"Cancel"}),(0,o.jsx)(l.zxk,{size:"md",colorScheme:"primary",bgColor:"primary.800",onClick:function(){return i(r)},"data-testid":"confirm-btn",isDisabled:!r,flex:1,children:"Next"})]})})]})]})},P=n(82026),S=n(32556),I=n(61186),M=n(34038),R=function(){var e=(0,l.pmc)(),t=(0,r.Z)((0,P.vm)(),1)[0],n=(0,m.useCallback)(function(){var n=(0,i.Z)((function(n){var i,s,r;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return i=n.isEnabled,s=n.templateId,[4,t({templateId:s,template:{is_enabled:i}})];case 1:return r=a.sent(),(0,M.D4)(r)?(e((0,I.Vo)((0,S.e$)(r.error))),[2]):(e((0,I.t5)("Messaging template ".concat(i?"enabled":"disabled"))),[2])}}))}));return function(e){return n.apply(this,arguments)}}(),[t,e]);return{toggleIsTemplateEnabled:n}},w=n(77802),k=n(62257),Z=(0,u.Cl)(),z={items:[],total:0,page:1,size:50,pages:1},A=function(){return(0,o.jsx)(l.gCW,{mt:6,p:10,spacing:4,borderRadius:"base",maxW:"70%","data-testid":"no-results-notice",alignSelf:"center",margin:"auto",textAlign:"center",children:(0,o.jsxs)(l.gCW,{children:[(0,o.jsx)(l.xvT,{fontSize:"md",fontWeight:"600",children:"It looks like it\u2019s your first time here!"}),(0,o.jsxs)(l.xvT,{fontSize:"sm",children:["Add new email templates with the ",'"Add message +"'," button.",(0,o.jsx)("br",{})]})]})})},q=function(){var e=(0,k.gz)({page:1,size:100}),t=e.isLoading,n=e.data,i=null===n||void 0===n?void 0:n.items.filter((function(e){return!e.messaging_templates||0===e.messaging_templates.length})),s=Boolean(!t&&(null===i||void 0===i?void 0:i.length)),a="missing-messages-notice-".concat(null===i||void 0===i?void 0:i.map((function(e){return e.id})).join("-")),u=(0,r.Z)((0,f._)("notices.dismissedMessageNoticeId",""),2),c=u[0],d=u[1];return s&&!(a===c)?(0,o.jsx)(l.xuv,{mb:6,"data-testid":"notice-properties-without-messaging-templates",children:(0,o.jsx)(h.Z,{title:"Not all properties have messages configured.",text:(0,o.jsxs)(l.xvT,{as:"span",children:["You have properties that do not have messages configured. Users who submit privacy requests for these properties may not receive the necessary emails regarding their requests."," ",(0,o.jsx)(l.xuv,{as:"span",children:(0,o.jsx)(y.Z,{label:null===i||void 0===i?void 0:i.map((function(e){return e.name})).join(", ")})})]}),onClose:function(){d(a)}})}):null},V=function(){var e=(0,w.tB)({api_set:!1}).data;return(null===e||void 0===e?void 0:e.notifications.enable_property_specific_messaging)?null:(0,o.jsx)(l.xuv,{mb:6,"data-testid":"notice-properties-without-messaging-templates",children:(0,o.jsx)(h.Z,{title:"Basic messaging enabled",text:(0,o.jsxs)(l.xvT,{as:"span",children:["In basic messaging mode, you can edit the content of your messages from this screen. Please note that in basic messaging, the \u201cEnable\u201d toggle does not apply. Fides also supports property specific messaging mode. Read our"," ",(0,o.jsx)(l.rUS,{href:"https://fid.es/property-specific-messaging",target:"_blank",rel:"nofollow",textDecoration:"underline",children:"docs"})," ","for more information about property specific mode or contact"," ",(0,o.jsx)(l.rUS,{href:"mailto:support@ethyca.com",textDecoration:"underline",children:"Ethyca support"})," ","to enable this mode on your Fides instance."]})})})},B=function(){var e=(0,g.useRouter)(),t=R().toggleIsTemplateEnabled,n=(0,T.oi)(),r=n.PAGE_SIZES,f=n.pageSize,h=n.setPageSize,y=n.onPreviousPageClick,E=n.isPreviousPageDisabled,_=n.onNextPageClick,S=n.isNextPageDisabled,I=n.startRange,M=n.endRange,w=n.pageIndex,k=n.setTotalPages,B=(0,P.ms)({page:w,size:f}),N=B.data,D=B.isLoading,U=B.isFetching,O=(0,m.useMemo)((function(){return null!==N&&void 0!==N?N:z}),[N]),Q=O.items,W=O.total,Y=O.pages;(0,m.useEffect)((function(){k(Y)}),[Y,k]);var L=(0,m.useState)(!1),G=L[0],F=L[1],H=(0,m.useMemo)((function(){return[Z.accessor((function(e){return e.type}),{id:"message",cell:function(e){return(0,o.jsx)(T.G3,{value:j.Z[e.getValue()]})},header:function(e){return(0,o.jsx)(T.Rr,(0,s.Z)({value:"Message"},e))},size:150}),Z.accessor((function(e){return(e.properties||[]).map((function(e){return e.name}))}),{id:"properties",cell:function(e){return(0,o.jsx)(T.WP,(0,s.Z)({suffix:"properties",value:e.getValue()},e))},header:function(e){return(0,o.jsx)(T.Rr,(0,s.Z)({value:"Properties"},e))},meta:{displayText:"Properties",showHeaderMenu:!0},size:250}),Z.accessor((function(e){return e.is_enabled}),{id:"is_enabled",cell:function(e){return(0,o.jsx)(l.kCb,{align:"center",justifyContent:"flex-start",w:"full",h:"full",children:(0,o.jsx)(l.rsf,{name:"is_enabled_".concat(e.row.original.id),isChecked:e.getValue(),colorScheme:"complimentary",onChange:function(){var n=(0,i.Z)((function(n){return(0,a.__generator)(this,(function(i){return t({isEnabled:n.target.checked,templateId:e.row.original.id}),[2]}))}));return function(e){return n.apply(this,arguments)}}()})})},header:function(e){return(0,o.jsx)(T.Rr,(0,s.Z)({value:"Enable"},e))},size:200,meta:{disableRowClick:!0}})]}),[t]),X=(0,m.useMemo)((function(){return(0,d.sortBy)(Q,"id")}),[Q]),J=(0,c.b7)({getCoreRowModel:(0,u.sC)(),getFilteredRowModel:(0,u.vL)(),getSortedRowModel:(0,u.tj)(),columns:H,data:X});return(0,o.jsxs)(p.Z,{title:"Messaging",mainProps:{padding:"0 40px 10px"},children:[(0,o.jsx)(v.Z,{breadcrumbs:[{title:"Messaging"}],children:(0,o.jsx)(l.xvT,{fontWeight:500,color:"gray.700",children:"Configure Fides messaging."})}),(0,o.jsx)(V,{}),(0,o.jsx)(q,{}),(0,o.jsx)(T.Q$,{children:(0,o.jsx)(l.Ugi,{alignItems:"center",spacing:4,marginLeft:"auto",children:(0,o.jsx)(l.zxk,{size:"xs",colorScheme:"primary","data-testid":"add-message-btn",onClick:function(){return F(!0)},children:"Add message +"})})}),D?(0,o.jsx)(T.I4,{rowHeight:36,numRows:15}):(0,o.jsx)(T.ZK,{tableInstance:J,onRowClick:function(t){e.push({pathname:x.ax,query:{id:t.id}})},emptyTableNotice:(0,o.jsx)(A,{})}),(0,o.jsx)(b.s8,{totalRows:W,pageSizes:r,setPageSize:h,onPreviousPageClick:y,isPreviousPageDisabled:E||U,onNextPageClick:_,isNextPageDisabled:S||U,startRange:I,endRange:M}),(0,o.jsx)(C,{isOpen:G,onClose:function(){return F(!1)},onAccept:function(t){e.push({pathname:x.sM,query:{templateType:t}})}})]})}},34038:function(e,t,n){"use strict";n.d(t,{Bw:function(){return i.Bw},D4:function(){return i.D4}});var i=n(32764)}},function(e){e.O(0,[8033,3667,3659,9774,2888,179],(function(){return t=24081,e(e.s=t);var t}));var t=e.O();_N_E=t}]);