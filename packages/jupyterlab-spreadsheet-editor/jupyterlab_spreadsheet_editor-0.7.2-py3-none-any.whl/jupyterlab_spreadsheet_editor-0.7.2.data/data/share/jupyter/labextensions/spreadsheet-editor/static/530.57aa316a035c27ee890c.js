"use strict";(self.webpackChunkspreadsheet_editor=self.webpackChunkspreadsheet_editor||[]).push([[530],{116:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>$,SpreadsheetEditorFactory:()=>X,addCreateNewCommands:()=>te,addCreateNewToLauncher:()=>ee,addUndoRedoToEditMenu:()=>q,default:()=>se});var s=n(85),o=n(652),i=n(768),l=n(586),a=n(316),r=n(383),h=n(379),c=n.n(h),d=n(795),u=n.n(d),m=n(569),g=n.n(m),p=n(565),w=n.n(p),v=n(216),x=n.n(v),_=n(589),b=n.n(_),f=n(760),C={};C.styleTagTransform=b(),C.setAttributes=w(),C.insert=g().bind(null,"head"),C.domAPI=u(),C.insertStyleElement=x(),c()(f.Z,C),f.Z&&f.Z.locals&&f.Z.locals;var y=n(882),M=n(930),I=n(281),j=n(480),L=n.n(j),k=n(806),A=n.n(k),S=n(901);class R extends y.Widget{constructor(e){super(),this.jexcel=null,this.linebreak="\n",this.selectAllElement=null,this.header=void 0,this.columnTypes=[],this._ready=new M.PromiseDelegate,this.id=M.UUID.uuid4(),this.title.label=I.PathExt.basename(e.localPath),this.title.closable=!0,this.context=e,this.separator="",this.fitMode="all-equal-default",e.localPath.endsWith("tsv")&&(this.separator="\t"),e.localPath.endsWith("csv")&&(this.separator=","),this.hasFrozenColumns=!1,this.firstRowAsHeader=!1,e.ready.then((()=>{this._onContextReady()})).catch(console.warn),this.changed=new S.Signal(this),this._selection={rows:0,columns:0},this.selectionChanged=new S.Signal(this);const t=document.createElement("div");t.className="se-area-container",this.node.appendChild(t),this.columnTypesBar=document.createElement("div"),this.columnTypesBar.classList.add("se-column-types"),this.columnTypesBar.classList.add("se-hidden"),this.columnTypeSelectors=new Map,t.appendChild(this.columnTypesBar),this.editor=document.createElement("div"),t.appendChild(this.editor),this.container=t}parseValue(e){const t=L().parse(e,{delimiter:this.separator});this.separator||(this.separator=t.meta.delimiter),this.linebreak=t.meta.linebreak,t.errors.length&&console.warn("Parsing errors encountered",t.errors);const n=this.extractColumnNumber(t.data);return void 0===this.columnTypes&&(this.columnTypes=[...Array(n).map((()=>"text"))]),this.firstRowAsHeader?this.header=t.data.shift():this.header=void 0,t.data}extractColumnNumber(e){return e.length?e[0].length:0}columns(e){const t=[];for(let n=0;n<e;n++)t.push({title:this.header?this.header[n]:void 0,type:this.columnTypes[n]});return t}onChange(){this.context.model.sharedModel.setSource(this.getValue()),this.changed.emit()}get selection(){return this._selection}_onContextReady(){if(this.isDisposed)return;const e=this.context.model,t=e.toString(),n=this.parseValue(t),s={data:n,allowExport:!1,minDimensions:[1,1],csvFileName:this.title.label,contextMenu:!1,columnDrag:!0,onchange:()=>{this.onChange()},oninsertrow:()=>{this.onChange()},oninsertcolumn:()=>{this.onChange(),this.populateColumnTypesBar(),this.onResize()},onmoverow:()=>{this.onChange()},onmovecolumn:()=>{this.onChange()},ondeleterow:()=>{this.onChange()},ondeletecolumn:()=>{this.onChange(),this.populateColumnTypesBar(),this.onResize()},onresizecolumn:()=>{this.adjustColumnTypesWidth()},onselection:(e,t,n,s,o,i)=>{this._selection={rows:o-n+1,columns:s-t+1},this.selectionChanged.emit(this._selection),this.scrollCellIntoView({column:t,row:n})},columns:this.columns(this.extractColumnNumber(n))};this.createEditor(s),e.contentChanged.connect(this._onContentChanged,this),this.populateColumnTypesBar(),n.length&&n[0].length*n.length<1e4&&(this.fitMode="fit-cells",this.relayout()),this._ready.resolve(void 0)}reloadEditor(e){const t=this.jexcel.getConfig();this.jexcel.destroy(),this.createEditor({...t,...e}),this.relayout()}switchHeaders(){const e=this.getValue();this.firstRowAsHeader=!this.firstRowAsHeader;const t=this.parseValue(e);this.reloadEditor({data:t,columns:this.columns(this.extractColumnNumber(t))})}switchTypesBar(){this.columnTypesBar.classList.toggle("se-hidden")}populateColumnTypesBar(){const e=["text","numeric","hidden","dropdown","autocomplete","checkbox","radio","calendar","image","color","html"];this.columnTypesBar.innerHTML="",this.columnTypeSelectors.clear();for(let t=0;t<this.columnsNumber;t++){const n=document.createElement("select");for(const t of e){const e=document.createElement("option");e.value=t,e.text=t,n.appendChild(e)}n.onchange=e=>{const n=e.target;this.columnTypes[t]=n.options[n.selectedIndex].value,this.reloadEditor({columns:this.columns(this.columnTypes.length)})},this.columnTypeSelectors.set(t,n),this.columnTypesBar.appendChild(n)}}adjustColumnTypesWidth(){if(!this.selectAllElement||0===this.columnTypeSelectors.size)return;this.columnTypesBar.style.marginLeft=this.selectAllElement.offsetWidth+"px";const e=this.jexcel.getWidth(void 0);for(let t=0;t<this.columnsNumber;t++)this.columnTypeSelectors.get(t).style.width=e[t]+"px"}createEditor(e){this.jexcel=A()(this.editor,e),this.selectAllElement=this.jexcel.headerContainer.querySelector(".jexcel_selectall")}onAfterShow(e){super.onAfterShow(e),this.relayout()}get ready(){return this._ready.promise}getValue(){const e=this.jexcel.getData();return this.firstRowAsHeader&&e.unshift(this.jexcel.getHeaders(!0)),L().unparse(e,{delimiter:this.separator,newline:this.linebreak})}setValue(e){const t=this.parseValue(e);this.jexcel.setData(t)}_onContentChanged(){const e=this.getValue(),t=this.context.model.toString();e!==t&&this.setValue(t)}get wrapper(){return this.hasFrozenColumns?this.jexcel.content:this.container}onResize(){this.jexcel&&("all-equal-fit"===this.fitMode&&this.relayout(),this.hasFrozenColumns&&(this.jexcel.content.style.width=this.node.offsetWidth+"px",this.jexcel.content.style.height=this.node.querySelector(".jexcel_content").offsetHeight+"px"),this.adjustColumnTypesWidth())}onActivateRequest(e){this.editor.focus()}dispose(){this.jexcel&&this.jexcel.destroy(),super.dispose()}updateModel(){this.context.model.sharedModel.setSource(this.getValue())}freezeSelectedColumns(){const e=this.jexcel.getSelectedColumns();this.reloadEditor({freezeColumns:Math.max(...e)+1,tableOverflow:!0,tableWidth:this.node.offsetWidth+"px",tableHeight:this.node.offsetHeight+"px"}),this.hasFrozenColumns=!0}unfreezeColumns(){this.reloadEditor({freezeColumns:void 0,tableOverflow:!1,tableWidth:void 0,tableHeight:void 0}),this.hasFrozenColumns=!1}get columnsNumber(){const e=this.jexcel.getData();return e.length?e[0].length:0}getHeaderElements(){const e=[];for(const t of this.jexcel.headerContainer.children)"jexcel_selectall"!==t.className&&e.push(t);return e}relayout(){if(!this.jexcel)return;const e=this.columnsNumber;if(e){switch(this.fitMode){case"all-equal-default":{const t=this.jexcel.getConfig();for(let n=0;n<e;n++)this.jexcel.setWidth(n,t.defaultColWidth,void 0);break}case"all-equal-fit":{const t=this.node.querySelector(".jexcel_selectall"),n=(this.node.clientWidth-t.offsetWidth)/e;for(let t=0;t<e;t++)this.jexcel.setWidth(t,n,void 0);break}case"fit-cells":{const t=this.jexcel.getData(),n=this.getHeaderElements();for(let s=0;s<e;s++){let e=Math.max(25,n[s].scrollWidth);for(let n=0;n<t.length;n++){const t=this.jexcel.getCellFromCoords(s,n);e=Math.max(e,t.scrollWidth)}this.jexcel.setWidth(s,e,void 0)}break}}this.adjustColumnTypesWidth()}}scrollCellIntoView(e){const t=this.jexcel.getCellFromCoords(e.column,e.row),n=t.getBoundingClientRect(),s=this.wrapper.getBoundingClientRect();let o=!1;n.right>s.right?this.wrapper.scrollBy(n.right-s.right,0):n.left<s.left&&this.wrapper.scrollBy(n.left-s.left,0),n.top-3<s.top&&(o=!0),(o||n.bottom+3>s.bottom)&&t.scrollIntoView(o)}}const T=new a.LabIcon({name:"spreadsheet:freeze-columns",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M20.79 13.95l-2.33.62l-2-1.13v-2.88l2-1.13l2.33.62l.52-1.93l-1.77-.47l.46-1.77l-1.93-.52l-.62 2.33l-2 1.13L13 7.38V5.12l1.71-1.71L13.29 2L12 3.29L10.71 2L9.29 3.41L11 5.12v2.26L8.5 8.82l-2-1.13l-.58-2.33L4 5.88l.47 1.77l-1.77.47l.52 1.93l2.33-.62l2 1.13v2.89l-2 1.13l-2.33-.62l-.52 1.93l1.77.47L4 18.12l1.93.52l.62-2.33l2-1.13L11 16.62v2.26l-1.71 1.71L10.71 22L12 20.71L13.29 22l1.41-1.41l-1.7-1.71v-2.26l2.5-1.45l2 1.13l.62 2.33l1.88-.51l-.47-1.77l1.77-.47l-.51-1.93M9.5 10.56L12 9.11l2.5 1.45v2.88L12 14.89l-2.5-1.45v-2.88z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),E=new a.LabIcon({name:"spreadsheet:unfreeze-columns",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11 5.12L9.29 3.41L10.71 2L12 3.29L13.29 2l1.42 1.41L13 5.12v2.26l2.45 1.44l2-1.13l.62-2.33l1.93.52l-.46 1.77l1.77.47l-.52 1.93l-2.33-.62l-2 1.13v2.7L14.5 11.3v-.74l-1.76-1.02l-2.01-2.01l.27-.15V5.12m7.46 9.45l-1.59-.9l2.68 2.68l1.75-.47l-.51-1.93l-2.33.62M13 16.62v2.26l1.7 1.71L13.29 22L12 20.71L10.71 22l-1.42-1.41L11 18.88v-2.26l-2.45-1.44l-2 1.13l-.62 2.33L4 18.12l.47-1.76l-1.77-.47l.52-1.93l2.33.62l2-1.13v-2.89l-2-1.13l-2.33.62l-.52-1.93l1.77-.47L4 5.89L1.11 3l1.28-1.27l19.72 19.73l-1.27 1.27L14.1 16l-1.1.62m-1-1.73l.63-.39l-3.13-3.11v2.05l2.5 1.45z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),V=new a.LabIcon({name:"spreadsheet:remove-column",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M4 2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h7v-4H4m0 6v4h7v-4H4M4 4v4h7V4H4m13.59 8L15 9.41L16.41 8L19 10.59L21.59 8L23 9.41L20.41 12L23 14.59L21.59 16L19 13.41L16.41 16L15 14.59L17.59 12z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),z=new a.LabIcon({name:"spreadsheet:add-column",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2h9m-7 8v4h7v-4H4m0 6v4h7v-4H4M4 4v4h7V4H4m11 7h3V8h2v3h3v2h-3v3h-2v-3h-3v-2z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),W=new a.LabIcon({name:"spreadsheet:remove-row",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9.41 13L12 15.59L14.59 13L16 14.41L13.41 17L16 19.59L14.59 21L12 18.41L9.41 21L8 19.59L10.59 17L8 14.41L9.41 13M22 9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v3M4 9h4V6H4v3m6 0h4V6h-4v3m6 0h4V6h-4v3z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),B=new a.LabIcon({name:"spreadsheet:add-row",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M22 10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3h2v2h4V3h2v2h4V3h2v2h4V3h2v7M4 10h4V7H4v3m6 0h4V7h-4v3m10 0V7h-4v3h4m-9 4h2v3h3v2h-3v3h-2v-3H8v-2h3v-3z" fill="#626262" class=\'jp-icon3\'/></svg>\n'});var D=n(996);class H extends i.DocumentWidget{constructor(e){super(e);const t=e.translator||D.nullTranslator;this._trans=t.load("spreadsheet-editor");const n=new l.ToolbarButton({icon:B,onClick:()=>{this.content.jexcel.insertRow(),this.content.updateModel()},tooltip:this._trans.__("Insert a row at the end")});this.toolbar.addItem("spreadsheet:insert-row",n);const s=new l.ToolbarButton({icon:W,onClick:()=>{this.content.jexcel.deleteRow(this.content.jexcel.rows.length-1,1),this.content.updateModel()},tooltip:this._trans.__("Remove the last row")});this.toolbar.addItem("spreadsheet:remove-row",s);const o=new l.ToolbarButton({icon:z,onClick:()=>{this.content.jexcel.insertColumn(),this.content.updateModel()},tooltip:this._trans.__("Insert a column at the end")});this.toolbar.addItem("spreadsheet:insert-column",o);const i=new l.ToolbarButton({icon:V,onClick:()=>{this.content.jexcel.deleteColumn(this.content.columnsNumber),this.content.updateModel()},tooltip:this._trans.__("Remove the last column")});this.toolbar.addItem("spreadsheet:remove-column",i);let r=!0;const h=new l.ToolbarButton({icon:new a.LabIcon({name:"spreadsheet:show-hide-index",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7 13v-2h14v2H7m0 6v-2h14v2H7M7 7V5h14v2H7M3 8V5H2V4h2v4H3m-1 9v-1h3v4H2v-1h2v-.5H3v-1h1V17H2m2.25-7a.75.75 0 0 1 .75.75c0 .2-.08.39-.21.52L3.12 13H5v1H2v-.92L4 11H2v-1h2.25z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),onClick:()=>{r?this.content.jexcel.hideIndex():this.content.jexcel.showIndex(),r=!r},tooltip:this._trans.__("Show/hide row numbers")});this.toolbar.addItem("spreadsheet:show-hide-index",h);const c=new l.ToolbarButton({icon:new a.LabIcon({name:"spreadsheet:fit-columns",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 8h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2m0 4v3h6v-3H5m8 0v3h6v-3h-6m-8 5v3h6v-3H5m8 0v3h6v-3h-6M11 2h10v4h-2V4h-6v2h-2V2z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),onClick:()=>{switch(this.content.fitMode){case"fit-cells":this.content.fitMode="all-equal-fit";break;case"all-equal-fit":this.content.fitMode="all-equal-default";break;case"all-equal-default":this.content.fitMode="fit-cells"}this.content.relayout()},tooltip:this._trans.__("Fit columns width")});this.toolbar.addItem("spreadsheet:fit-columns",c);const d=new l.ToolbarButton({icon:T,onClick:()=>{this.content.freezeSelectedColumns()},tooltip:this._trans.__("Freeze the initial columns (up to the selected column)")});this.toolbar.addItem("spreadsheet:freeze-columns",d);const u=new l.ToolbarButton({icon:E,onClick:()=>{this.content.unfreezeColumns()},tooltip:this._trans.__("Unfreeze frozen column")});this.toolbar.addItem("spreadsheet:unfreeze-columns",u);const m=new l.ToolbarButton({icon:new a.LabIcon({name:"spreadsheet:switch-headers",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 2v4h12V4H6z" fill="#626262" class=\'jp-icon3\'/></svg>\n\n'}),onClick:()=>{this.content.switchHeaders()},tooltip:this._trans.__("First row as a header")});this.toolbar.addItem("spreadsheet:switch-headers",m);const g=new l.ToolbarButton({icon:new a.LabIcon({name:"spreadsheet:column-types",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 9.5L7.5 14h-5L5 9.5M3 4h4v4H3V4m2 16a2 2 0 0 0 2-2a2 2 0 0 0-2-2a2 2 0 0 0-2 2a2 2 0 0 0 2 2M9 5v2h12V5H9m0 14h12v-2H9v2m0-6h12v-2H9v2z" fill="#626262" class=\'jp-icon3\'/></svg>\n'}),onClick:()=>{this.content.switchTypesBar()},tooltip:this._trans.__("Show/hide column types bar")});this.toolbar.addItem("spreadsheet:switch-column-types-bar",g)}}class N{constructor(){this._set=new Set}_valueToString(e){return void 0===e?e:e.column+"|"+e.row}_stringToValue(e){if(void 0===e)return e;const t=e.split("|");return 2!==t.length&&console.warn("A problem with stringToValue input detected!"),{column:parseInt(t[0],10),row:parseInt(t[1],10)}}add(e){return this._set.add(this._valueToString(e)),this}delete(e){return this._set.delete(this._valueToString(e))}has(e){return this._set.has(this._valueToString(e))}values(){const e=this._set.values(),t=this._stringToValue;return{[Symbol.iterator](){return this},return(n){const s=e.return(n);return{done:s.done,value:t(s.value)}},next(){const n=e.next();return{done:n.done,value:t(n.value)}},throw(){const n=e.throw();return{done:n.done,value:t(n.value)}}}}clear(){return this._set.clear()}}class Z{createNew(e){return new O(e)}isApplicable(e){return e instanceof i.DocumentWidget&&e.content instanceof R}}class O extends r.SearchProvider{constructor(e){super(e),this.isReadOnly=!1,this._initialQueryCoodrs=null,this._changed=new S.Signal(this),this._query=null,this._matches=[],this._currentMatchIndex=0,this._sheet=e.content,this._target=this._sheet.jexcel,this.backlitMatches=new N}get changed(){return this._changed}get currentMatchIndex(){return this._currentMatchIndex}get matches(){return this._matches}get matchesCount(){return this._matches.length}endQuery(){return this.backlightOff(),this._currentMatchIndex=0,this._matches=[],this._sheet.changed.disconnect(this._onSheetChanged,this),Promise.resolve(void 0)}async clearHighlight(){this.backlightOff()}backlightOff(){for(const e of this.backlitMatches.values())this._target.getCellFromCoords(e.column,e.row).classList.remove("se-backlight");this.backlitMatches.clear()}async endSearch(){return null==this._target.selectedCell&&this.mostRecentSelectedCell&&(this._target.selectedCell=this.mostRecentSelectedCell),this.endQuery()}getSelectedCellCoordinates(){const e=this._target,t=e.getSelectedColumns(),n=e.getSelectedRows(!0);return 1===n.length&&1===t.length?{column:t[0],row:n[0]}:null}getInitialQuery(){const e=this.getSelectedCellCoordinates();if(this._initialQueryCoodrs=e,e){const t=this._target.getValueFromCoords(e.column,e.row,!1);if(t)return t.toString()}return this._target.resetSelection(!0),""}async highlightNext(){this._currentMatchIndex+1<this.matches.length?this._currentMatchIndex+=1:this._currentMatchIndex=0;const e=this.matches[this._currentMatchIndex];if(e)return this.highlight(e),e}async highlightPrevious(){this._currentMatchIndex>0?this._currentMatchIndex-=1:this._currentMatchIndex=this.matches.length-1;const e=this.matches[this._currentMatchIndex];if(e)return this.highlight(e),e}highlight(e){this.backlightMatches(),this._target.updateSelectionFromCoords(e.column,e.row,e.column,e.row,null),this.mostRecentSelectedCell=this._target.selectedCell,this._target.selectedCell=null,this._sheet.scrollCellIntoView({row:e.row,column:e.column})}async replaceAllMatches(e){for(let t=0;t<this.matches.length;t++)this._currentMatchIndex=t,await this.replaceCurrentMatch(e,!0);return this._matches=this.findMatches(),this.backlightMatches(),!0}async replaceCurrentMatch(e,t=!1){let n=!1;const s=this.matches[this._currentMatchIndex],o=this._target.getValueFromCoords(s.column,s.row,!1);let i=-1,l=0;const a=String(o).replace(this._query,(t=>(i+=1,l+=1,i===s.position?(n=!0,e):t)));let r=this._currentMatchIndex+1;for(;r<this.matches.length;){const e=this.matches[r];if(e.column!==s.column||e.row!==s.row)break;e.position-=1,r+=1}if(this._target.setValueFromCoords(s.column,s.row,a,!1),!t&&1===l){const e={column:s.column,row:s.row};this._target.getCellFromCoords(s.column,s.row).classList.remove("se-backlight"),this.backlitMatches.delete(e)}return t||await this.highlightNext(),n}_onSheetChanged(){this._matches=this.findMatches(!1),this.backlightOff(),this.backlightMatches(),this._changed.emit(void 0)}backlightMatches(e=1e3){for(let t=Math.max(0,this._currentMatchIndex-e/2);t<Math.min(this._currentMatchIndex+e/2,this.matches.length);t++){const e=this.matches[t],n={column:e.column,row:e.row};this.backlitMatches.has(n)||(this._target.getCellFromCoords(e.column,e.row).classList.add("se-backlight"),this.backlitMatches.add(n))}}findMatches(e=!0){const t=this._initialQueryCoodrs;this._initialQueryCoodrs=null;let n=0;const s=this._query;if(!s)return[];const o=[],i=this._target.getData();let l=0,a=-1,r=0,h=0;for(const e of i){for(const i of e){if(a+=1,!i)continue;const e=String(i).match(s);if(e){r=0,null!==t&&t.row===l&&t.column===a&&(n=h);for(const t of e)o.push({row:l,column:a,position:r,text:t}),r+=1,h+=1}}a=-1,l+=1}return this._currentMatchIndex=n,this._matches=o,o.length&&e&&this.highlight(o[this._currentMatchIndex]),o}async startQuery(e,t){const n=this.widget;this._sheet=n.content,this._query=e,this._sheet.changed.connect(this._onSheetChanged,this),this.findMatches()}}var F=n(615),Y=n(416),G=n(655),P=n(29);class U extends l.VDomRenderer{constructor(e){super(new U.Model),this.translator=e||D.nullTranslator,this._trans=this.translator.load("spreadsheet-editor")}render(){if(!this.model)return null;const e=this.model.selection;if(!e)return P.createElement(G.TextItem,{source:""});if(e.rows<=1&&e.columns<=1)return P.createElement(G.TextItem,{source:""});this.node.title=this._trans._n("Selected %1 row","Selected %1 rows",e.rows)+this._trans._n(" and %1 column"," and %1 columns",e.columns);const t=this._trans._n("%1 row","%1 rows",e.rows)+this._trans._n(", %1 column",", %1 columns",e.columns);return P.createElement(G.TextItem,{source:t})}}!function(e){class t extends l.VDomModel{constructor(){super(...arguments),this._spreadsheetWidget=null}get selection(){var e;return null===(e=this.spreadsheetWidget)||void 0===e?void 0:e.selection}set spreadsheetWidget(e){this._spreadsheetWidget&&this._spreadsheetWidget.selectionChanged.disconnect(this._triggerChange,this),this._spreadsheetWidget=e,this._spreadsheetWidget&&this._spreadsheetWidget.selectionChanged.connect(this._triggerChange,this),this._triggerChange()}get spreadsheetWidget(){return this._spreadsheetWidget}_triggerChange(){this.stateChanged.emit(void 0)}}e.Model=t}(U||(U={}));const Q="Spreadsheet Editor",J="Spreadsheet Editor";class X extends i.ABCWidgetFactory{createNewWidget(e){const t=new R(e);return new H({content:t,context:e,translator:this.translator})}}function q(e){const t=e=>e instanceof i.DocumentWidget&&e.content instanceof R;e.editMenu.undoers.undo.add({id:$.undo,isEnabled:t}),e.editMenu.undoers.redo.add({id:$.redo,isEnabled:t})}function K(e,t,n="tsv"){return e.execute("docmanager:new-untitled",{path:t,type:"file",ext:n}).then((t=>e.execute("docmanager:open",{path:t.path,factory:J})))}var $;function ee(e,t){e.add({command:$.createNewCSV,category:t.__("Other"),rank:3}),e.add({command:$.createNewTSV,category:t.__("Other"),rank:3})}function te(e,t,n,s,o,i){const l=()=>{var e,t;return null===(t=null===(e=n.currentWidget)||void 0===e?void 0:e.content)||void 0===t?void 0:t.jexcel};e.addCommand($.undo,{label:i.__("Undo"),icon:a.undoIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();e&&e.undo()},isEnabled:()=>{const e=l();return!!e&&0!==e.history.length&&0!==e.historyIndex}}),e.addCommand($.redo,{label:i.__("Redo"),icon:a.redoIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();e&&e.redo()},isEnabled:()=>{const e=l();return!!e&&0!==e.history.length&&e.historyIndex!==e.history.length-1}}),e.addCommand($.copy,{label:i.__("Copy"),icon:a.copyIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();e&&e.copy(!0)},isEnabled:()=>!!l()}),e.addCommand($.paste,{label:i.__("Paste"),icon:a.pasteIcon.bindprops({stylesheet:"menuItem"}),execute:async()=>{const e=l();if(!e)return;const t=e.selectedCell;if(!t)return;const n=await navigator.clipboard.readText();n&&e.paste(t[0],t[1],n)},isEnabled:()=>!!l()}),e.addCommand($.insertRowBelow,{label:i.__("Insert Row Below"),icon:a.addBelowIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-y]"))),s=(null==n?void 0:n.dataset.y)?parseInt(n.dataset.y,10):void 0;e.insertRow(1,s)},isEnabled:()=>!!l()}),e.addCommand($.insertRowAbove,{label:i.__("Insert Row Above"),icon:a.addAboveIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-y]"))),s=(null==n?void 0:n.dataset.y)?parseInt(n.dataset.y,10):void 0;e.insertRow(1,s,!0)},isEnabled:()=>!!l()}),e.addCommand($.insertColumnLeft,{label:i.__("Insert Column To The Left"),icon:a.addIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-x]"))),s=(null==n?void 0:n.dataset.x)?parseInt(n.dataset.x,10):void 0;e.insertColumn(1,s,!0)},isEnabled:()=>!!l()}),e.addCommand($.insertColumnRight,{label:i.__("Insert Column To The Right"),icon:a.addIcon.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-x]"))),s=(null==n?void 0:n.dataset.x)?parseInt(n.dataset.x,10):void 0;e.insertColumn(1,s,!1)},isEnabled:()=>!!l()}),e.addCommand($.removeColumn,{label:i.__("Delete Column"),icon:V.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-x]")));if(!n)return;const s=parseInt(n.dataset.x,10);e.deleteColumn(s)},isEnabled:()=>!!l()}),e.addCommand($.removeRow,{label:i.__("Delete Row"),icon:W.bindprops({stylesheet:"menuItem"}),execute:()=>{const e=l();if(!e)return;const n=t((e=>e.matches("td[data-y]")));if(!n)return;const s=parseInt(n.dataset.y,10);e.deleteRow(s)},isEnabled:()=>!!l()}),e.addCommand($.createNewCSV,{label:e=>e.isPalette?i.__("New CSV File"):i.__("CSV File"),caption:i.__("Create a new CSV file"),icon:e=>e.isPalette?void 0:a.spreadsheetIcon,execute:t=>{var n;const i=null!==(n=null==s?void 0:s.tracker.currentWidget)&&void 0!==n?n:o,l=t.cwd||i.model.path;return K(e,l,"csv")}}),e.addCommand($.createNewTSV,{label:e=>e.isPalette?i.__("New TSV File"):i.__("TSV File"),caption:i.__("Create a new TSV file"),icon:e=>e.isPalette?void 0:a.spreadsheetIcon,execute:t=>{var n;const i=null!==(n=null==s?void 0:s.tracker.currentWidget)&&void 0!==n?n:o,l=t.cwd||i.model.path;return K(e,l,"tsv")}})}!function(e){e.createNewCSV="spreadsheet-editor:create-new-csv-file",e.createNewTSV="spreadsheet-editor:create-new-tsv-file",e.undo="spreadsheet-editor:undo",e.redo="spreadsheet-editor:redo",e.copy="spreadsheet-editor:copy",e.paste="spreadsheet-editor:paste",e.insertRowBelow="spreadsheet-editor:insert-row-below",e.insertRowAbove="spreadsheet-editor:insert-row-above",e.insertColumnLeft="spreadsheet-editor:insert-column-left",e.insertColumnRight="spreadsheet-editor:insert-column-right",e.removeColumn="spreadsheet-editor:remove-column",e.removeRow="spreadsheet-editor:remove-row"}($||($={}));const ne="spreadsheet-editor:plugin",se={id:ne,autoStart:!0,requires:[Y.IFileBrowserFactory,Y.IDefaultFileBrowser],optional:[l.ICommandPalette,F.ILauncher,o.IMainMenu,s.ILayoutRestorer,r.ISearchProviderRegistry,G.IStatusBar,D.ITranslator],activate:(e,t,n,s,o,i,a,r,h,c)=>{const d=(c=c||D.nullTranslator).load(ne),u=new X({name:J,fileTypes:["csv","tsv","*"],defaultFor:["csv","tsv"],translator:c}),m=new l.WidgetTracker({namespace:ne});a&&a.restore(m,{command:"docmanager:open",args:e=>({path:e.context.path,factory:J}),name:e=>e.context.path}),e.docRegistry.addWidgetFactory(u);const g=e.docRegistry.getFileType("csv");if(u.widgetCreated.connect(((e,t)=>{m.add(t),t.context.pathChanged.connect((()=>{m.save(t)})),g&&(t.title.icon=g.icon,t.title.iconClass=g.iconClass,t.title.iconLabel=g.iconLabel)})),r&&r.add(ne,new Z),te(e.commands,e.contextMenuHitTest.bind(e),m,t,n,d),s&&(s.addItem({command:$.createNewCSV,args:{isPalette:!0},category:Q}),s.addItem({command:$.createNewTSV,args:{isPalette:!0},category:Q})),o&&ee(o,d),i&&q(i),h){const t=new U(c);m.currentChanged.connect((()=>{var e;const n=m.currentWidget;t.model.spreadsheetWidget=null!==(e=null==n?void 0:n.content)&&void 0!==e?e:null})),h.registerStatusItem(ne,{item:t,align:"right",rank:4,isActive:()=>!!e.shell.currentWidget&&!!m.currentWidget&&e.shell.currentWidget===m.currentWidget})}}}},150:(e,t,n)=>{n.d(t,{Z:()=>c});var s=n(81),o=n.n(s),i=n(645),l=n.n(i),a=n(984),r=n(524),h=l()(o());h.i(a.Z),h.i(r.Z),h.push([e.id,"table.jexcel {\n  border-top: 0;\n  border-left: 0;\n}\n\n.jexcel_container {\n  overflow: visible;\n  padding: 0;\n}\n\n.jexcel_contextmenu {\n  display: none;\n}\n\n.jexcel_content {\n  padding: 0;\n}\n\n.se-area-container {\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n}\n\n.se-column-types {\n  width: max-content;\n  height: var(--jp-private-toolbar-height);\n}\n\n.se-column-types select {\n  display: inline-block;\n}\n\n.se-hidden {\n  display: none;\n}\n\nsvg[data-icon='spreadsheet:column-types'] {\n  transform: rotate(90deg);\n}\n\n/**\nDark theme\n */\nbody[data-jp-theme-light='false'] .jexcel_container {\n  /* use https://bossanova.uk/jexcel/v4/cases/themes tool to adjust */\n  --jexcel_header_color: #ccc;\n  --jexcel_header_color_highlighted: #ddd;\n  --jexcel_header_background: #313131;\n  --jexcel_header_background_highlighted: #777;\n  --jexcel_content_color: #fff;\n  --jexcel_content_color_highlighted: #333;\n  --jexcel_content_background: #111;\n  --jexcel_content_background_highlighted: #333;\n  --jexcel_menu_background: #7e7e7e;\n  --jexcel_menu_background_highlighted: #ebebeb;\n  --jexcel_menu_color: #ddd;\n  --jexcel_menu_color_highlighted: #222;\n  --jexcel_menu_box_shadow: unset;\n  --jexcel_border_color: #5f5f5f;\n  --jexcel_border_color_highlighted: #999;\n  --active_color: #eee;\n}\n\nbody[data-jp-theme-light='false'] .se-backlight {\n  background: rgb(85 45 0 / 75%);\n}\n\n/**\nLight theme\n */\nbody[data-jp-theme-light='true'] .jexcel_container {\n  --jexcel_header_color: #000;\n  --jexcel_header_color_highlighted: #000;\n  --jexcel_header_background: #f3f3f3;\n  --jexcel_header_background_highlighted: #dcdcdc;\n  --jexcel_content_color: #000;\n  --jexcel_content_color_highlighted: #000;\n  --jexcel_content_background: #fff;\n  --jexcel_content_background_highlighted: rgb(0 0 0 / 5%);\n  --jexcel_menu_background: #fff;\n  --jexcel_menu_background_highlighted: #ebebeb;\n  --jexcel_menu_color: #555;\n  --jexcel_menu_color_highlighted: #555;\n  --jexcel_menu_box_shadow: 2px 2px 2px 0px rgb(143 144 145 / 100%);\n  --jexcel_border_color: #ccc;\n  --jexcel_border_color_highlighted: #000;\n  --active_color: #007aff;\n}\n\nbody[data-jp-theme-light='true'] .se-backlight {\n  background: rgb(255 255 0 / 75%);\n}\n",""]);const c=h},760:(e,t,n)=>{n.d(t,{Z:()=>h});var s=n(81),o=n.n(s),i=n(645),l=n.n(i),a=n(150),r=l()(o());r.i(a.Z),r.push([e.id,"\n",""]);const h=r},634:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFuGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTAxLTMxVDE4OjU1OjA4WiIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOS0wMS0zMVQxODo1NTowOFoiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTAxLTMxVDE4OjU1OjA4WiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDphMTlhZDJmOC1kMDI2LTI1NDItODhjOS1iZTRkYjkyMmQ0MmQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpkOGI5NDUyMS00ZjEwLWQ5NDktYjUwNC0wZmU1N2I3Nzk1MDEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplMzdjYmE1ZS1hYTMwLWNkNDUtYTAyNS1lOWYxZjk2MzUzOGUiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplMzdjYmE1ZS1hYTMwLWNkNDUtYTAyNS1lOWYxZjk2MzUzOGUiIHN0RXZ0OndoZW49IjIwMTktMDEtMzFUMTg6NTU6MDhaIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmExOWFkMmY4LWQwMjYtMjU0Mi04OGM5LWJlNGRiOTIyZDQyZCIgc3RFdnQ6d2hlbj0iMjAxOS0wMS0zMVQxODo1NTowOFoiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4En6MDAAAAX0lEQVQYlX3KOw6AIBBAwS32RpJADXfx0pTET+ERZJ8F8RODFtONsG0QAoh0CSDM82dqodaBdQXnfoLZQM7gPai+wjNNE8R4pTuAYNZSKZASqL7CMy0LxNgJp30fKYUDi3+vIqb/+rUAAAAASUVORK5CYII="},485:e=>{e.exports="data:image/svg+xml,%0A%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27none%27 d=%27M0 0h24v24H0V0z%27/%3E%3Cpath d=%27M7 10l5 5 5-5H7z%27 fill=%27gray%27/%3E%3C/svg%3E"},461:e=>{e.exports="data:image/svg+xml,%0A%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27none%27 d=%27M0 0h24v24H0V0z%27/%3E%3Cpath d=%27M7 10l5 5 5-5H7z%27 fill=%27lightgray%27/%3E%3C/svg%3E"},141:e=>{e.exports="data:image/svg+xml,%0A%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27none%27 d=%27M0 0h24v24H0V0z%27/%3E%3Cpath d=%27M7 14l5-5 5 5H7z%27 fill=%27gray%27/%3E%3C/svg%3E"},395:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27gray%27 width=%2718px%27 height=%2718px%27%3E%3Cpath d=%27M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z%27/%3E%3Cpath d=%27M0 0h24v24H0z%27 fill=%27none%27/%3E%3C/svg%3E"},782:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27%3E%3Cpath d=%27M10 17l5-5-5-5v10z%27/%3E%3Cpath fill=%27none%27 d=%27M0 24V0h24v24H0z%27/%3E%3C/svg%3E"},422:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27%3E%3Cpath d=%27M14 7l-5 5 5 5V7z%27/%3E%3Cpath fill=%27none%27 d=%27M24 0v24H0V0h24z%27/%3E%3C/svg%3E"},472:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyBmaWxsPSdibGFjaycgaGVpZ2h0PScyNCcgdmlld0JveD0nMCAwIDI0IDI0JyB3aWR0aD0nMjQnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHBhdGggZD0nTTcgMTBsNSA1IDUtNXonLz48cGF0aCBkPSdNMCAwaDI0djI0SDB6JyBmaWxsPSdub25lJy8+PC9zdmc+"}}]);