import{d as C,r as m,o as X,a as x,b as n,c as d,e,f as o,w as se,g as p,h as v,i as V,t as $,F as K,j as M,E as Z,_ as L,u as O,k as ee,l as ae,m as I,n as ne,p as P,q as B,s as te,v as W,x as A,y as Y,z as ie}from"./index-eJPIzJhh.js";import{h as T}from"./axios--FnjuHWf.js";/* empty css                                                                       */import{_ as re}from"./HomeView.vue_vue_type_script_setup_true_lang-2CuHYA43.js";const ce={style:{padding:"10px 10px"}},de={key:0},ue={key:1},_e={key:0},pe={key:1},he=e("br",null,null,-1),ve={key:2,style:{color:"#909399","font-size":"12px"}},me=C({__name:"ContactsList",emits:["wxid"],setup(t,{emit:r}){const l=m([]),a=m({}),s=async()=>{try{return await T.post("/api/recent_user_list",{})}catch(u){return console.error("Error fetching data:",u),[]}},c=async(u="")=>{try{return await T.post("/api/user_list",{word:u})}catch(U){return console.error("Error fetching data:",U),[]}},y=async()=>{try{return await T.post("/api/user_labels_dict",{})}catch(u){return console.error("Error fetching data:",u),[]}},h=u=>{let U="";if(u.length===0)return"";for(let z=0;z<u.length;z++)U+=a.value[u[z]]+" ";return U};X(async()=>{try{l.value=await s(),a.value=await y()}catch(u){return console.error("Error fetching data:",u),[]}});const w=m(""),f=async()=>{try{if(w.value===""){l.value=await s();return}l.value=await c(w.value)}catch(u){return console.error("Error fetching data:",u),[]}},k=r,q=u=>{u!==void 0&&k("wxid",u.wxid)};return(u,U)=>{const z=x("el-input"),j=x("el-button"),H=x("el-avatar"),g=x("el-table-column"),D=x("el-tooltip"),E=x("el-table");return n(),d("div",null,[e("div",ce,[o(z,{placeholder:"请输入关键字",modelValue:w.value,"onUpdate:modelValue":U[0]||(U[0]=i=>w.value=i),onKeyup:se(f,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),o(j,{type:"primary",onClick:f,style:{width:"50px"}},{default:p(()=>[v("搜索")]),_:1})]),o(E,{data:l.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:q},{default:p(()=>[o(g,{width:"57"},{default:p(({row:i})=>[i.headImgUrl!==""?(n(),V(H,{key:0,size:33,src:"/api/imgsrc/"+i.headImgUrl},null,8,["src"])):(n(),V(H,{key:1,size:33},{default:p(()=>[v(" 群聊 ")]),_:1}))]),_:1}),o(g,{width:"190"},{default:p(({row:i})=>[i.LabelIDList.length>0?(n(),V(D,{key:0,class:"item",effect:"light",content:h(i.LabelIDList),placement:"right"},{default:p(()=>[i.remark!==null&&i.remark!==""?(n(),d("span",de,$(i.remark),1)):(n(),d("span",ue,$(i.nickname),1))]),_:2},1032,["content"])):(n(),d(K,{key:1},[i.remark!==null&&i.remark!==""?(n(),d("span",_e,$(i.remark),1)):(n(),d("span",pe,$(i.nickname),1))],64)),he,i.LastReadedCreateTime?(n(),d("span",ve,$(i.LastReadedCreateTime),1)):M("",!0)]),_:1})]),_:1},8,["data"])])}}}),fe=C({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},emits:["exporting"],setup(t,{emit:r}){const l=m(!1),a=async()=>{if(l.value){console.log("正在获取实时消息，请稍后再试!");return}l.value=!0;try{const _=await T.post("/api/realtimemsg",{});return l.value=!1,Z({title:"Success",message:"获取实时消息成功!",type:"success"}),_}catch(_){return l.value=!1,Z({title:"Error",message:"获取实时消息失败!",type:"error"}),console.error("Error fetching data:",_),[]}},s=m(!1),c=r,y=()=>{c("exporting",!0),s.value=!0},h=()=>{c("exporting",!1),s.value=!1};return(_,w)=>{const f=x("el-text"),k=x("el-col"),q=x("el-row");return n(),d(K,null,[o(q,{gutter:5,style:{width:"100%"}},{default:p(()=>[o(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("wxid:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.wxid},{default:p(()=>[v($(t.userData.wxid),1)]),_:1},8,["title"])]),_:1}),o(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("账号:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.account},{default:p(()=>[v($(t.userData.account),1)]),_:1},8,["title"])]),_:1}),o(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("昵称:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.nickname},{default:p(()=>[v($(t.userData.nickname),1)]),_:1},8,["title"])]),_:1}),o(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("备注:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.remark},{default:p(()=>[v($(t.userData.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),o(q,{gutter:5,style:{width:"100%"}},{default:p(()=>[o(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("数量:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.msg_count},{default:p(()=>[v($(t.userData.msg_count),1)]),_:1},8,["title"])]),_:1}),o(k,{span:15,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[v("描述:")]),_:1}),v("  "),o(f,{class:"data_color mx-1",truncated:"",title:t.userData.describe},{default:p(()=>[v($(t.userData.describe),1)]),_:1},8,["title"])]),_:1}),o(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[o(f,{class:"button_color mx-1 underline",truncated:"",onClick:w[0]||(w[0]=u=>{a()})},{default:p(()=>[v("实时消息 "),l.value?(n(),d(K,{key:0},[v("(获取中)")],64)):M("",!0)]),_:1})]),_:1}),o(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[s.value?M("",!0):(n(),V(f,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:w[1]||(w[1]=u=>{y()})},{default:p(()=>[v("导出备份")]),_:1})),s.value?(n(),V(f,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:w[2]||(w[2]=u=>{h()})},{default:p(()=>[v("聊天查看")]),_:1})):M("",!0)]),_:1})]),_:1})],64)}}}),ye=L(fe,[["__scopeId","data-v-0c9eea5d"]]),xe={class:"chat-content"},we={key:0,class:"word"},ge=["src"],be={class:"info"},$e={class:"time"},ke=["innerHTML"],Se={key:1,class:"word-my"},Ve={class:"info"},Ue={class:"time"},Ee=["innerHTML"],Me=["src"],Ce=C({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const r=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(n(),d("div",xe,[t.is_sender?(n(),d("div",Se,[e("div",Ve,[e("p",Ue,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,Ee)]),e("img",{src:t.headUrl},null,8,Me)])):(n(),d("div",we,[e("img",{src:t.headUrl},null,8,ge),e("div",be,[e("p",$e,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,ke)])]))]))}}),Te=L(Ce,[["__scopeId","data-v-d930be9e"]]),De={class:"chat-content"},qe={key:0,class:"word"},ze=["src"],Re={class:"info"},je={class:"time"},He={class:"demo-image__preview"},Ie={key:1,class:"word-my"},Oe={class:"info"},Le={class:"time"},Ne={class:"demo-image__preview"},Be=["src"],Fe=C({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>{const a=x("el-image");return n(),d("div",De,[t.is_sender?(n(),d("div",Ie,[e("div",Oe,[e("p",Le,$(t.direction),1),e("div",Ne,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Be)])):(n(),d("div",qe,[e("img",{src:t.headUrl},null,8,ze),e("div",Re,[e("p",je,$(t.direction),1),e("div",He,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),We=L(Fe,[["__scopeId","data-v-24d6aaa0"]]),Ae={class:"chat-content"},Pe={key:0,class:"word"},Ke=["src"],Ge={class:"info"},Ye={class:"time"},Je={class:"demo-video__preview"},Xe={controls:"",width:"30%"},Qe=["src"],Ze={key:1,class:"word-my"},et={class:"info"},tt={class:"time"},lt={class:"demo-video__preview"},nt={controls:"",width:"50%"},ot=["src"],st=["src"],at=C({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>(n(),d("div",Ae,[t.is_sender?(n(),d("div",Ze,[e("div",et,[e("p",tt,$(t.direction),1),e("div",lt,[e("video",nt,[e("source",{src:t.src,type:"video/mp4"},null,8,ot)])])]),e("img",{src:t.headUrl},null,8,st)])):(n(),d("div",Pe,[e("img",{src:t.headUrl},null,8,Ke),e("div",Ge,[e("p",Ye,$(t.direction),1),e("div",Je,[e("video",Xe,[e("source",{src:t.src,type:"video/mp4"},null,8,Qe)])])])]))]))}}),it=L(at,[["__scopeId","data-v-5aa79515"]]),rt={class:"chat-content"},ct={key:0,class:"word"},dt=["src"],ut={class:"info"},_t={class:"time"},pt={controls:"",style:{"background-color":"#fff"}},ht=["src"],vt={key:1,class:"word-my"},mt={class:"info"},ft={class:"time"},yt={controls:"",style:{"background-color":"#95EC69"}},xt=["src"],wt=["src"],gt=C({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(r,l)=>(n(),d("div",rt,[t.is_sender?(n(),d("div",vt,[e("div",mt,[e("p",ft,$(t.direction),1),e("audio",yt,[e("source",{src:t.src,type:"audio/wav"},null,8,xt)]),o(O(ee),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,wt)])):(n(),d("div",ct,[e("img",{src:t.headUrl},null,8,dt),e("div",ut,[e("p",_t,$(t.direction),1),e("audio",pt,[e("source",{src:t.src,type:"audio/wav"},null,8,ht)]),o(O(ee),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),bt=L(gt,[["__scopeId","data-v-0d0f2cd4"]]),$t={class:"chat-content"},kt={key:0,class:"word"},St=["src"],Vt={class:"info"},Ut={class:"time"},Et={style:{float:"left"}},Mt=["href"],Ct={key:1,class:"word-my"},Tt={class:"info"},Dt={class:"time"},qt={style:{float:"right"}},zt=["href"],Rt=["src"],jt=C({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const r=t,l=m(""),a=ae({file_name:String,file_size:Number,file_size_unit:String});X(async()=>{console.log("文件加载中");const c=await s(r.src);a.file_name=c.file_name,a.file_size=Number(c.file_size)/1024,a.file_size<1024?a.file_size_unit="kb":(a.file_size=a.file_size/1024,a.file_size_unit="mb"),a.file_size=Number(c.file_size)/1024,l.value=`/api/file/${r.src}`});const s=async c=>{try{return await T.post("/api/file_info",{file_path:c})}catch(y){return console.error("Error fetching file_info:",y),""}};return(c,y)=>{const h=x("el-card");return n(),d("div",$t,[t.is_sender?(n(),d("div",Ct,[e("div",Tt,[e("p",Dt,$(t.direction),1),e("div",qt,[o(h,{shadow:"hover",style:{width:"fit-content"}},{default:p(()=>[v("文件 ： "),e("a",{href:l.value,download:""},$(a.file_name),9,zt),e("div",null,[v(" 文件大小："),e("span",null,$(a.file_size)+$(a.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,Rt)])):(n(),d("div",kt,[e("img",{src:t.headUrl},null,8,St),e("div",Vt,[e("p",Ut,$(t.direction),1),e("div",Et,[o(h,{shadow:"hover",style:{width:"fit-content"}},{default:p(()=>[v("文件 ： "),e("a",{href:l.value,download:""},$(a.file_name),9,Mt),e("div",null,[v(" 文件大小："),e("span",null,$(a.file_size)+$(a.file_size_unit),1)])]),_:1})])])]))])}}}),Ht=L(jt,[["__scopeId","data-v-e797f204"]]),It={class:"chat-content"},Ot={key:0,class:"word"},Lt=["src"],Nt={class:"info"},Bt={class:"time"},Ft={class:"demo-image__preview"},Wt={key:1,class:"word-my"},At={class:"info"},Pt={class:"time"},Kt={class:"demo-image__preview"},Gt=["src"],Yt=C({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>{const a=x("el-image");return n(),d("div",It,[t.is_sender?(n(),d("div",Wt,[e("div",At,[e("p",Pt,$(t.direction),1),e("div",Kt,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Gt)])):(n(),d("div",Ot,[e("img",{src:t.headUrl},null,8,Lt),e("div",Nt,[e("p",Bt,$(t.direction),1),e("div",Ft,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Jt=L(Yt,[["__scopeId","data-v-ad34c109"]]),Xt={class:"chat-content"},Qt={key:0,class:"word"},Zt=["src"],el={class:"info"},tl={class:"time"},ll=["innerHTML"],nl={key:1,class:"word-my"},ol={class:"info"},sl={class:"time"},al=["innerHTML"],il=["src"],rl=C({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const r=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(n(),d("div",Xt,[t.is_sender?(n(),d("div",nl,[e("div",ol,[e("p",sl,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,al)]),e("img",{src:t.headUrl},null,8,il)])):(n(),d("div",Qt,[e("img",{src:t.headUrl},null,8,Zt),e("div",el,[e("p",tl,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,ll)])]))]))}}),cl=L(rl,[["__scopeId","data-v-e529325a"]]),dl={id:"chat"},ul={class:"chat_body"},_l={class:"chat_window",ref:"chatWindow"},pl={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},hl=C({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:r}){const l=t,a=m([]),s=m({}),c=m(!1),y=m(""),h=m(0),_=m(100),w=m(0),f=m(!1),k=async(g,D,E)=>{if(c.value){console.log("正在获取消息，请稍后再试!");return}if(E==""){console.log("wxid 为空, 请检查!");return}try{c.value=!0,g<0&&(g=0);const i=await T.post("/api/msgs",{start:g,limit:D,wxid:E});return a.value=i.msg_list,s.value=Object.assign(s.value,i.user_list),c.value=!1,i}catch(i){return c.value=!1,console.error("Error fetching data:",i),[]}},q=async g=>{try{return(await T.post("/api/msg_count",{wxid:g}))[g]}catch(D){return console.error("Error fetching data msg_count:",D),[]}},u=async()=>{try{return(await T.get("/api/mywxid")).my_wxid}catch(g){return console.error("Error fetching data my_wxid:",g),[]}},U=async()=>{try{y.value=await u(),w.value=await q(l.userData.wxid),h.value=w.value-_.value,h.value<0&&(h.value=0),await k(h.value,_.value,l.userData.wxid),f.value||await P(()=>{l.setScrollTop(),f.value=!1})}catch(g){return console.error("Error fetching data:",g),[]}};I(()=>l.userData.wxid,(g,D)=>{console.log("username changed： ",D,g),a.value=[],s.value={},f.value=!1,w.value=0,h.value=0,U()});const z=async()=>{y.value=await u(),w.value=await q(l.userData.wxid);let g=_.value,D=h.value-g;D<0&&(D=0);const E=await k(D,g,l.userData.wxid);h.value=D,console.log("loadMore",D,h.value,g,l.userData.wxid),a.value=E.msg_list.concat(a.value),a.value.sort((i,N)=>i.id-N.id),a.value=a.value.filter((i,N,J)=>N===0||i.id!==J[N-1].id),s.value=Object.assign(s.value,E.user_list),await P(()=>{l.updateScrollTop()})};r({loadMore:z});const j=g=>(g.talker=="我"&&(g.talker=y.value),`${(E=>s.value.hasOwnProperty(E.talker)?s.value[E.talker].remark?s.value[E.talker].remark:s.value[E.talker].nickname?s.value[E.talker].nickname:s.value[E.talker].account?s.value[E.talker].account:E.talker:E.talker)(g)} [${g.type_name}] ${g.CreateTime}`),H=g=>(g.talker=="我"&&(g.talker=y.value),s.value.hasOwnProperty(g.talker)?"/api/imgsrc/"+s.value[g.talker].headImgUrl:"");return(g,D)=>{const E=x("el-button");return n(),d("div",dl,[e("div",ul,[e("div",_l,[a.value.length<w.value?(n(),d("div",pl,[o(E,{type:"primary",onClick:z},{default:p(()=>[v("查看更多消息")]),_:1})])):M("",!0),(n(!0),d(K,null,ne(a.value,(i,N)=>(n(),d("div",{class:"message",key:N},[i.type_name=="文本"?(n(),V(Te,{key:0,is_sender:i.is_sender,direction:j(i),headUrl:H(i),content:i.content.msg},null,8,["is_sender","direction","headUrl","content"])):i.type_name=="图片"?(n(),V(We,{key:1,is_sender:i.is_sender,direction:j(i),headUrl:H(i),src:"/api/img/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="动画表情"?(n(),V(Jt,{key:2,is_sender:i.is_sender,direction:j(i),headUrl:H(i),src:"/api/imgsrc/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="视频"?(n(),V(it,{key:3,is_sender:i.is_sender,direction:j(i),headUrl:H(i),src:"/api/video/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="文件"?(n(),V(Ht,{key:4,is_sender:i.is_sender,direction:j(i),headUrl:H(i),src:i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="语音"?(n(),V(bt,{key:5,is_sender:i.is_sender,direction:j(i),headUrl:H(i),src:"/api/"+i.content.src,msg:i.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(n(),V(cl,{key:6,is_sender:i.is_sender,direction:j(i),headUrl:H(i),content:i.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),vl=L(hl,[["__scopeId","data-v-49e80cb1"]]),ml=e("br",null,null,-1),fl=e("br",null,null,-1),yl={style:{position:"relative"}},xl=C({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(c,y)=>{console.log(c)});const l=m(""),a=m(""),s=async()=>{a.value="请求中...";try{a.value=await T.post("/api/export_endb",{wx_path:l.value})}catch(c){return console.error("Error fetching data msg_count:",c),a.value=`请求失败
`+c,[]}};return(c,y)=>{const h=x("el-input"),_=x("el-button"),w=x("el-divider");return n(),d("div",null,[v(" 微信文件夹路径(可选)： "),o(h,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":y[0]||(y[0]=f=>l.value=f),style:{width:"70%"}},null,8,["modelValue"]),ml,fl,e("div",yl,[o(_,{type:"primary",onClick:y[1]||(y[1]=f=>s())},{default:p(()=>[v("导出")]),_:1})]),o(w),o(h,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":y[2]||(y[2]=f=>a.value=f),style:{width:"100%"}},null,8,["modelValue"])])}}}),wl=e("br",null,null,-1),gl=e("br",null,null,-1),bl=e("br",null,null,-1),$l=e("br",null,null,-1),kl={style:{position:"relative"}},Sl=C({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(y,h)=>{console.log(y)});const l=m(""),a=m(""),s=m(""),c=async()=>{s.value="正在处理中...";try{s.value=await T.post("/api/export_dedb",{key:a.value,wx_path:l.value})}catch(y){return console.error("Error fetching data msg_count:",y),s.value=`请求失败
`+y,[]}};return(y,h)=>{const _=x("el-input"),w=x("el-button"),f=x("el-divider");return n(),d("div",null,[v(" 密钥(可选)： "),o(_,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=k=>a.value=k),style:{width:"75%"}},null,8,["modelValue"]),wl,gl,v(" 微信文件夹路径(可选)： "),o(_,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":h[1]||(h[1]=k=>l.value=k),style:{width:"70%"}},null,8,["modelValue"]),bl,$l,e("div",kl,[o(w,{type:"primary",onClick:h[2]||(h[2]=k=>c())},{default:p(()=>[v("导出")]),_:1})]),o(f),o(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":h[3]||(h[3]=k=>s.value=k),style:{width:"100%"}},null,8,["modelValue"])])}}}),Vl={style:{position:"relative"}},Ul=C({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(s,c)=>{console.log(s)});const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_csv",{wxid:r.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,c)=>{const y=x("el-button"),h=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",Vl,[o(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[v("导出")]),_:1})]),o(h),o(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),El={style:{position:"relative"}},Ml=C({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(s,c)=>{console.log(s)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_json",{wxid:r.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,c)=>{const y=x("el-button"),h=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",El,[o(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[v("导出")]),_:1})]),o(h),o(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Cl={style:{position:"relative"}},Tl=C({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(s,c)=>{console.log(s)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_html",{wxid:r.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,c)=>{const y=x("el-button"),h=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",Cl,[o(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[v("导出")]),_:1})]),o(h),o(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Dl=e("br",null,null,-1),ql=C({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(a,s)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,s)=>{const c=x("el-button");return n(),d("div",null,[e("span",null,$(r.wxid),1),Dl,o(c,{type:"primary",onClick:s[0]||(s[0]=y=>l())},{default:p(()=>[v("导出")]),_:1})])}}}),zl=e("br",null,null,-1),Rl=C({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(a,s)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,s)=>{const c=x("el-button");return n(),d("div",null,[e("span",null,$(r.wxid),1),zl,o(c,{type:"primary",onClick:s[0]||(s[0]=y=>l())},{default:p(()=>[v("导出")]),_:1})])}}}),jl={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Hl={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Il={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Ol=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Ll={style:{"margin-top":"20px"}},Nl=e("br",null,null,-1),Bl=e("br",null,null,-1),Fl={key:0},Wl=C({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(s,c)=>{console.log(s)});const l=m("");m("");const a={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(s,c)=>{const y=x("el-option"),h=x("el-select"),_=x("el-divider"),w=x("el-main");return n(),d("div",jl,[o(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:p(()=>[e("div",Hl,[e("div",Il,[Ol,e("div",Ll,[v(" 导出类型: "),o(h,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=f=>l.value=f)},{default:p(()=>[(n(),d(K,null,ne(a,(f,k)=>o(y,{label:f.brief,value:k,key:k},{default:p(()=>[v($(f.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Nl,Bl,l.value?(n(),d("span",Fl,$(a[l.value].detail),1)):M("",!0)]),o(_),l.value=="endb"?(n(),V(xl,{key:0,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="dedb"?(n(),V(Sl,{key:1,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="csv"?(n(),V(Ul,{key:2,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="json"?(n(),V(Ml,{key:3,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="html"?(n(),V(Tl,{key:4,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="pdf"?(n(),V(ql,{key:5,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="docx"?(n(),V(Rl,{key:6,wxid:r.wxid},null,8,["wxid"])):M("",!0)])])]),_:1})])}}}),Al=C({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const r=m(null),l=m(null);m(0);const a=m(0),s=()=>{P(()=>{if(r.value){const u=r.value.$el.children[0];u&&(u.scrollTop=u.scrollHeight,a.value=u.scrollHeight)}})},c=()=>{const u=r.value.$el.children[0];if(u){const U=a.value,z=u.scrollHeight-U;u.scrollTop=u.scrollTop+z,a.value=u.scrollHeight}};function y({scrollTop:u}){u===0&&l.value&&l.value.loadMore()}const h=t,_=m({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",wxid:"",msg_count:0}),w=async()=>{try{const u=await T.post("/api/wxid2user",{wxid:h.wxid});return _.value.account=u[h.wxid].account,_.value.describe=u[h.wxid].describe,_.value.headImgUrl=u[h.wxid].headImgUrl,_.value.nickname=u[h.wxid].nickname,_.value.remark=u[h.wxid].remark,_.value.wxid=h.wxid,u}catch(u){return console.error("Error fetching data wxid2user :",u),[]}},f=async()=>{try{const u=await T.post("/api/msg_count",{wxid:h.wxid});return _.value.msg_count=u[h.wxid],u}catch(u){return console.error("Error fetching data msg_count:",u),[]}};X(()=>{f(),w(),P(()=>{s()})});const k=m(!1),q=u=>{k.value=u,k.value===!1&&(_.value.wxid="",w())};return I(()=>h.wxid,async(u,U)=>{u!==U&&(w(),f(),k.value=!1,P(()=>{s()}))}),(u,U)=>{const z=x("el-header"),j=x("el-scrollbar"),H=x("el-main"),g=x("el-container");return n(),V(g,null,{default:p(()=>[o(z,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:p(()=>[o(ye,{userData:_.value,onExporting:q},null,8,["userData"])]),_:1}),o(H,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:p(()=>[o(j,{ref_key:"scrollbarRef",ref:r,onScroll:y},{default:p(()=>[k.value?(n(),V(Wl,{key:0,wxid:_.value.wxid},null,8,["wxid"])):(n(),V(vl,{key:1,ref_key:"chatRecordsMainRef",ref:l,userData:_.value,setScrollTop:s,updateScrollTop:c},null,8,["userData"]))]),_:1},512)]),_:1})]),_:1})}}}),Pl={class:"progress-bar"},le=C({__name:"ProgressBar",props:{startORstop:{type:Number,required:!0}},setup(t){const r=m(0),l=m(500),a=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],s=m(new Date().getTime()),c=t,y=()=>{if(c.startORstop===1){r.value=100;return}s.value=new Date().getTime(),!(r.value>=99)&&(r.value>=80&&(l.value=l.value+50),r.value=r.value+1,setTimeout(y,l.value))};return y(),(h,_)=>{const w=x("el-progress");return n(),d("div",Pl,[o(w,{type:"dashboard",percentage:r.value,color:a},null,8,["percentage"])])}}}),Kl={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},Gl={key:0},Yl={key:0},Jl={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},Xl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),Ql={style:{"margin-top":"20px"}},Zl={style:{"margin-top":"20px"}},en={key:1},tn={key:0},ln={key:1,style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},nn=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),on={style:{"margin-top":"20px"}},sn={key:0},an=e("br",null,null,-1),rn=e("br",null,null,-1),cn={key:1},dn=e("br",null,null,-1),un=e("br",null,null,-1),_n={key:2},pn=e("label",null,"密钥key(必填): ",-1),hn=e("br",null,null,-1),vn={key:3},mn=e("label",null,"merge_all.db 文件路径(必填,非文件夹): ",-1),fn=e("br",null,null,-1),yn=e("label",null,"微信文件夹路径(必填): ",-1),xn=e("br",null,null,-1),wn=e("label",null,"微信原始id(必填): ",-1),gn=e("br",null,null,-1),bn={key:2},$n={style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},kn=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),Sn={style:{"margin-top":"20px"}},Vn={style:{"margin-top":"20px"}},Un={key:3,style:{display:"flex","justify-content":"space-between"}},En={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},Mn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"使用历史数据")],-1),Cn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},Tn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),Dn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},qn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),zn=C({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:r}){const l=m(0),a=m(-1),s=m(""),c=m(!1),y=m([]),h=m(""),_=m(!1),w=m(!1),f=m("false"),k=m(""),q=m(""),u=m(""),U=m(""),z=m([]),j=r,H=async()=>{try{y.value=await T.post("/api/wxinfo"),y.value.length===1&&(g(y.value[0]),h.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(D,5e3))}catch(S){return console.error("Error fetching data:",S),[]}},g=async S=>{k.value="",q.value=S.filePath,u.value=S.key,U.value=S.wxid},D=()=>{if(q.value===""&&u.value===""&&U.value===""){console.log("请填写完整信息! ");return}if(_.value){console.log("正在解密...，请稍后再试！");return}E()},E=async()=>{if(_.value){console.log("正在解密中，请稍后再试！");return}_.value=!0;try{_.value=!0,a.value=0;let S={wx_path:q.value,key:u.value,my_wxid:U.value};const b=await T.post("/api/init_key",S);c.value=b.is_init,b.is_init&&(l.value=100),_.value=!1,j("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,_.value=!1,Y.alert(S,"error",{confirmButtonText:"确认",callback:b=>{ie({type:"error",message:`action: ${b}`})}}),[]}_.value=!1},i=async()=>{try{let S={wx_path:q.value,merge_path:k.value,my_wxid:U.value};const b=await T.post("/api/init_nokey",S);c.value=b.is_init,b.is_init&&(l.value=100),_.value=!1,j("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,_.value=!1,Y.alert(S,"error",{confirmButtonText:"确认",callback:b=>{s.value=""}}),[]}_.value=!1},N=async S=>{U.value=S.wxid},J=async()=>{try{const S=await T.post("/api/init_last_local_wxid");z.value=S.local_wxids.map(b=>({wxid:b})),z.value.length===1&&(U.value=z.value[0],Q())}catch(S){return console.error("Error fetching data:",S),[]}},Q=async()=>{try{let S={wx_path:q.value,merge_path:k.value,my_wxid:U.value};console.log(S);const b=await T.post("/api/init_last",S);c.value=b.is_init,b.is_init?(l.value=100,_.value=!1,j("isAutoShow",b.is_init)):(w.value=!0,_.value=!1,Y.alert("未发现上次的设置数据！","error",{confirmButtonText:"确认",callback:F=>{s.value=""}})),_.value=!1}catch(S){return w.value=!0,_.value=!1,Y.alert(S,"error",{confirmButtonText:"确认",callback:b=>{s.value=""}}),[]}_.value=!1};return I(s,S=>{S==="auto"?H():S==="custom"||S==="last"&&J()}),(S,b)=>{const F=x("el-button"),oe=x("el-divider"),G=x("el-input");return n(),d("div",Kl,[s.value==="auto"?(n(),d("div",Gl,[_.value?(n(),d("div",Yl,[_.value?(n(),V(le,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(n(),d("div",Jl,[Xl,e("div",Ql,[o(O(te),{data:y.value,onCurrentChange:g,"highlight-current-row":"",style:{width:"100%"}},{default:p(()=>[o(O(B),{"min-width":30,prop:"pid",label:"进程id"}),o(O(B),{"min-width":40,prop:"version",label:"微信版本"}),o(O(B),{"min-width":40,prop:"account",label:"账号"}),o(O(B),{"min-width":40,prop:"name",label:"昵称"}),o(O(B),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",Zl,[o(F,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:D},{default:p(()=>[v("确定"+$(h.value),1)]),_:1})])]))])):s.value==="custom"?(n(),d("div",en,[_.value?(n(),d("div",tn,[_.value?(n(),V(le,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(n(),d("div",ln,[nn,e("div",on,[W(e("input",{type:"radio","onUpdate:modelValue":b[0]||(b[0]=R=>f.value=R),value:"true"},null,512),[[A,f.value]]),v(" 使用 KEY          "),W(e("input",{type:"radio","onUpdate:modelValue":b[1]||(b[1]=R=>f.value=R),value:"false"},null,512),[[A,f.value]]),v(" 不使用 KEY "),f.value=="false"?(n(),d("div",sn,[v(" 说明：1、表示数据库已解密并合并"),an,v("2、合并后的数据库需要包含(MediaMSG,MSG,MicroMsg,OpenIMMsg)这些数据库合并的内容"),rn])):M("",!0),f.value=="true"?(n(),d("div",cn,[v(" 说明：1、自动根据key解密微信文件夹下的数据库"),dn,v("2、必须保证key正确，否则解密失败"),un])):M("",!0),o(oe),f.value=="true"?(n(),d("div",_n,[pn,o(G,{placeholder:"密钥key (64位)",modelValue:u.value,"onUpdate:modelValue":b[2]||(b[2]=R=>u.value=R),style:{width:"80%"}},null,8,["modelValue"]),hn])):M("",!0),f.value=="false"?(n(),d("div",vn,[mn,o(G,{placeholder:"(MediaMSG.db,MSG.db,MicroMsg.db,OpenIMMsg.db)合并后的数据库",modelValue:k.value,"onUpdate:modelValue":b[3]||(b[3]=R=>k.value=R),style:{width:"80%"}},null,8,["modelValue"]),fn])):M("",!0),yn,o(G,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:q.value,"onUpdate:modelValue":b[4]||(b[4]=R=>q.value=R),style:{width:"80%"}},null,8,["modelValue"]),xn,wn,o(G,{placeholder:"wxid_*******",modelValue:U.value,"onUpdate:modelValue":b[5]||(b[5]=R=>U.value=R),style:{width:"80%"}},null,8,["modelValue"]),gn,f.value=="true"?(n(),V(F,{key:4,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:E},{default:p(()=>[v(" 确定 ")]),_:1})):M("",!0),f.value=="false"?(n(),V(F,{key:5,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:i},{default:p(()=>[v(" 确定 ")]),_:1})):M("",!0)])]))])):s.value==="last"?(n(),d("div",bn,[e("div",$n,[kn,e("div",Sn,[o(O(te),{data:z.value,onCurrentChange:N,"highlight-current-row":"",style:{width:"100%"}},{default:p(()=>[o(O(B),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",Vn,[o(F,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:Q},{default:p(()=>[v("确定 ")]),_:1})])])])):s.value===""?(n(),d("div",Un,[e("label",En,[W(e("input",{type:"radio","onUpdate:modelValue":b[6]||(b[6]=R=>s.value=R),value:"last"},null,512),[[A,s.value]]),Mn]),e("label",Cn,[W(e("input",{type:"radio","onUpdate:modelValue":b[7]||(b[7]=R=>s.value=R),value:"auto"},null,512),[[A,s.value]]),Tn]),e("label",Dn,[W(e("input",{type:"radio","onUpdate:modelValue":b[8]||(b[8]=R=>s.value=R),value:"custom"},null,512),[[A,s.value]]),qn])])):M("",!0)])}}}),Rn={id:"chat_view",class:"common-layout"},jn={key:0},Hn={key:1},In={key:0,style:{height:"calc(100vh)",width:"100%"}},On={key:1,style:{width:"100%",height:"100%"}},Wn=C({__name:"ChatView",setup(t){const r=m(!1),l=c=>{r.value=c},a=m(""),s=c=>{a.value=c};return(c,y)=>{const h=x("el-aside"),_=x("el-container");return n(),d("div",Rn,[r.value?(n(),d("div",Hn,[o(_,null,{default:p(()=>[o(h,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:p(()=>[o(me,{onWxid:s})]),_:1}),a.value!=""?(n(),d("div",In,[o(Al,{wxid:a.value},null,8,["wxid"])])):(n(),d("div",On,[o(re)]))]),_:1})])):(n(),d("div",jn,[o(zn,{onIsAutoShow:l})]))])}}});export{Wn as default};
