import{Y as F,c as q,_ as Q}from"./CNy_jkqZ.js";import{d as U,v as m,z as s,A as n,i as y,t as r,L as R,x as u,y as v,V as B,M as Z,N as H,O as P,P as V,B as d,Q as M,R as J,S,T as $,U as k,W as x,X as ee,Y as te,Z as T,$ as ae,C as se,D as ne}from"./C0MQPl7e.js";import{D as oe,V as C,O as ie,a as le,c as z,u as re,b as O,d as de}from"./DnhbA3Nq.js";import{s as ue,V as ce,a as pe}from"./Ch7oj-k2.js";import{S as me}from"./DRZoE4lq.js";import{V as ge,D as he}from"./C8qWC4yE.js";import{_ as Y}from"./DlAUqK2U.js";import{V as fe}from"./D82FP0wN.js";import{u as be}from"./NDDL-3Dc.js";import{D as ye}from"./C1CWdIzQ.js";import{V as W}from"./LFaxk6nF.js";import{V as G}from"./wJaZcIUU.js";import{V as K}from"./Bui7_cd4.js";import"./CpIzA0rN.js";import"./BdiRxMel.js";import"./CuvyPPI7.js";const ve={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},De=U({name:"VulnzTable",components:{DfRisk:oe},props:{vulnz:{type:Array,required:!0,default:()=>[]},vulnerabilityPreviewLoading:{type:Boolean,default:!1},selectedVulnerabilityKey:{type:String,required:!0}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left",width:"4%"},{title:"Risk | CVSS",value:"risk",align:"left",width:"7%"},{title:"Title",value:"title",align:"left",minWidth:"350"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){var a,c,f,D,b,g,o,p,I,N,_,L,l;const e=[];for(const t of this.vulnz)if(((a=t==null?void 0:t.kb)==null?void 0:a.title)==="Use of Outdated Vulnerable Component"){let w=!1;for(const i of t.vulnerabilities.vulnerabilities)if((i==null?void 0:i.metadata)===null||(i==null?void 0:i.metadata)===void 0)w||(e.push({key:i==null?void 0:i.id,goToVulnId:!1,risk:i==null?void 0:i.customRiskRating,title:t.kb.title,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb}),w=!0);else{const j=(c=i==null?void 0:i.metadata)==null?void 0:c.find(E=>E.name==="dependency_name").value,X=(f=i==null?void 0:i.metadata)==null?void 0:f.find(E=>E.name==="dependency_version").value;e.push({key:i.id,goToVulnId:!0,risk:i.customRiskRating,cvssV3:i.customCvssV3BaseScore,title:`${t.kb.title} for ${j} version ${X}`,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb})}}else e.push({key:(D=t==null?void 0:t.kb)==null?void 0:D.title,goToVulnId:!1,risk:t.highestRiskRating,title:(b=t==null?void 0:t.kb)==null?void 0:b.title,securityIssue:(g=t==null?void 0:t.kb)==null?void 0:g.securityIssue,privacyIssue:(o=t==null?void 0:t.kb)==null?void 0:o.privacyIssue,targetedByMalware:(p=t==null?void 0:t.kb)==null?void 0:p.targetedByMalware,targetedByRansomware:(I=t==null?void 0:t.kb)==null?void 0:I.targetedByRansomware,targetedByNationState:(N=t==null?void 0:t.kb)==null?void 0:N.targetedByNationState,hasPublicExploit:(_=t==null?void 0:t.kb)==null?void 0:_.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:(L=t==null?void 0:t.kb)==null?void 0:L.shortDescription,descriptionFormat:(l=t==null?void 0:t.kb)==null?void 0:l.shortDescriptionFormat,kb:t.kb});return ue(e).by([{desc:t=>{var w;return ve[((w=t==null?void 0:t.risk)==null?void 0:w.toLocaleLowerCase())||""]}},{desc:t=>t.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),ke=["onClick","onMouseup"],Ve=["onClick","onMouseup"];function we(e,a,c,f,D,b){const g=y("DfRisk");return r(),m("div",null,[s(ge,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":n(({item:o})=>[s(g,{"cvss-score":o.cvssV3,risk:o.risk,class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:R(p=>e.goToDetailNewTab(o),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":n(({item:o})=>[u("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:R(p=>e.goToDetailNewTab(o),["middle"])},v(o.title),41,ke)]),"item.description":n(({item:o})=>[u("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:R(p=>e.goToDetailNewTab(o),["middle"])},v(o.description),41,Ve)]),"item.show":n(({item:o})=>[s(B,{size:"small",variant:"text",disabled:e.vulnerabilityPreviewLoading===!0&&o.key!==e.selectedVulnerabilityKey,loading:e.vulnerabilityPreviewLoading===!0&&o.key===e.selectedVulnerabilityKey,icon:"mdi-magnify",onClick:p=>e.showVulnDetails(o)},null,8,["disabled","loading","onClick"])]),_:2},1032,["headers","items"])])}const Se=Y(De,[["render",we]]),$e=U({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:ce},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue","update:loading","afterLeave"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){var e;return(e=this.vuln)==null?void 0:e.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)},loading(e){this.$emit("update:loading",e),this.vuln!==null&&this.vuln!==void 0&&(e===!0?this.dialog=!1:this.dialog=!0)}}}),Te={id:"vulnerability-detail-container"};function Be(e,a,c,f,D,b){const g=y("VulnerabilityDetail");return r(),m("div",Te,[s(fe,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":a[1]||(a[1]=o=>e.dialog=o),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto",onAfterLeave:a[2]||(a[2]=o=>e.$emit("afterLeave"))},{default:n(()=>[s(C,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:n(()=>[s(g,{loading:e.loading,"onUpdate:loading":a[0]||(a[0]=o=>e.loading=o),"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["loading","vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Ce=Y($e,[["render",Be]]),A=1,Ie=U({name:"Index",components:{OXOAssets:ie,DfScanProgress:ye,DfConfirmationModal:he,VulnzTable:Se,VunerabilityDetailDialog:Ce,DfBreadcrumbs:le},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulenrabilityLoading:!1,vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new pe(this.$axios),scanService:new me(this.$axios),kb:null,title:"",progress:"UNKNOWN",vulns:[],loadingDialog:!0,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],agentGroup:null,show:!1,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},readOnly:!0},breadcrumbs:[{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${this.$route.params.scan}`,exact:!0,scans:[]}]}},computed:{...Z(be,["scanners"]),scanId(){return this.$route.params.scan===void 0||this.$route.params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt(this.$route.params.scan)},AgentGroupYaml(){var a,c;const e=(a=this.agentGroup)==null?void 0:a.yamlSource;return e==null?"No agent group found":`# Agent Group ID: ${(c=this.agentGroup)==null?void 0:c.id}
${F.stringify(F.parse(e))}`},totalVulnerabilities(){var e;return((e=this.vulns)==null?void 0:e.length)||0}},async mounted(){const e=this.scanners.find(a=>z(a.endpoint)===this.$route.params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...H(re,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){var e;try{this.loadingDialog=!0;const a=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=a,this.vulns=(a==null?void 0:a.kbVulnerabilities)||[],this.title=a==null?void 0:a.title,this.assets=a==null?void 0:a.assets,this.progress=(e=a==null?void 0:a.progress)==null?void 0:e.toLowerCase(),this.agentGroup=a==null?void 0:a.agentGroup}catch(a){this.reportError(`An error was encountered while fetching the scan: ${a}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:z(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const a=this.$router.resolve(`/scan/${z(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(a.href,"_blank")},async fetchScans(){this.breadcrumbs[A].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){var a,c,f;((c=((a=this.breadcrumbs[A])==null?void 0:a.scans)||[])==null?void 0:c.find(D=>{var b;return D.id===((b=this.kb)==null?void 0:b.id)}))===void 0&&(this.breadcrumbs[A].scans=[...((f=this.breadcrumbs[A])==null?void 0:f.scans)||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScan(this.scanner,this.scanId),await this.fetchKBVulnerabilities()}catch(e){this.reportError((e==null?void 0:e.message)||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScan(this.scanner,this.scanId),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}},async exportScan(){try{this.loadingDialog=!0,this.reportInfo("Scan export in progress, this process may take some time."),await this.scanService.exportScan(this.scanner,this.scanId),this.reportSuccess("Scan exported successfully")}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while exporting the scan")}finally{this.loadingDialog=!1}}}}),Ne=q(Q),h=e=>(se("data-v-91c514e7"),e=e(),ne(),e),_e=h(()=>u("span",null,"Stops scan. Stopped scans can't be restarted.",-1)),Le=h(()=>u("span",null,"Archives scan and removes all findings and artifacts.",-1)),Me=h(()=>u("span",null,"Exports scan to a zip file.",-1)),Ae=h(()=>u("p",{class:"mb-0 mr-2"}," Title: ",-1)),Ee={key:0,class:"mb-0"},Re={key:1},Pe={key:1},ze=h(()=>u("p",{class:"mb-0 mr-2"}," Targets: ",-1)),Oe=h(()=>u("p",{class:"mb-0 mr-2"}," Progress: ",-1)),Ge=h(()=>u("p",{class:"mb-0 mr-2"}," Date: ",-1)),Ke={key:0,class:"mb-0"},Ue={key:1},Ye={key:1},Fe=h(()=>u("p",{class:"mb-0 mr-2"}," Scanner: ",-1)),We={key:0},je={key:1},Xe=h(()=>u("span",null,"Agent Group",-1));function qe(e,a,c,f,D,b){const g=y("DfConfirmationModal"),o=y("VunerabilityDetailDialog"),p=y("DfBreadcrumbs"),I=y("OXOAssets"),N=y("DfScanProgress"),_=Ne,L=y("VulnzTable");return r(),m("div",null,[s(g,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":a[0]||(a[0]=l=>e.deleteScanDialog=l),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),s(g,{modelValue:e.stopScanDialog,"onUpdate:modelValue":a[1]||(a[1]=l=>e.stopScanDialog=l),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),s(o,{loading:e.vulenrabilityLoading,"onUpdate:loading":a[2]||(a[2]=l=>e.vulenrabilityLoading=l),"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":a[3]||(a[3]=l=>e.vulnDetailsDialog=l),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner,onAfterLeave:a[4]||(a[4]=l=>e.selectedVulnerability=null)},null,8,["loading","model-value","vuln","scan-id","scanner"]),s(p,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),s(C,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:n(()=>[s(G,{bottom:""},{activator:n(({props:l})=>[s(B,P({disabled:e.progress==="stopped"||e.progress==="done"||e.loadingDialog===!0,loading:e.stopBtnLoading,class:"mr-2"},l,{onClick:a[5]||(a[5]=t=>e.stopScanDialog=!0)}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-stop-circle-outline ")]),_:1}),d(" Stop ")]),_:2},1040,["disabled","loading"])]),default:n(()=>[_e]),_:1}),s(G,{bottom:""},{activator:n(({props:l})=>[s(B,P({loading:e.archiveBtnLoading,class:"mr-2"},l,{onClick:a[6]||(a[6]=t=>e.deleteScanDialog=!0)}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-delete-outline ")]),_:1}),d(" Delete ")]),_:2},1040,["loading"])]),default:n(()=>[Le]),_:1}),s(G,{bottom:""},{activator:n(({props:l})=>[s(B,P({class:"mr-2"},l,{onClick:e.exportScan}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-file-export-outline ")]),_:1}),d(" Export ")]),_:2},1040,["onClick"])]),default:n(()=>[Me]),_:1})]),_:1}),s(W,{class:"mt-4 align-stretch"},{default:n(()=>[s(K,{cols:"12",lg:"12"},{default:n(()=>[s(C,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:n(()=>[s(O,null,{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-shield-check-outline ")]),_:1}),d(" Scan Details ")]),_:1}),s(M),s(J,null,{default:n(()=>[s(S,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[Ae,e.title!==null&&e.title!==""?(r(),m("p",Ee,v(e.title),1)):(r(),m("div",Re,[e.loadingDialog===!0?(r(),k(T,{key:0,variant:"tonal",size:"small",label:"",style:{width:"80px"}})):(r(),m("span",Pe,"-"))]))]),_:1})]),_:1}),s(S,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[ze,e.loadingDialog===!0?(r(),k(T,{key:0,variant:"tonal",label:"",style:{width:"90px"}})):(r(),k(I,{key:1,assets:e.assets},null,8,["assets"]))]),_:1})]),_:1}),s(S,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[Oe,e.loadingDialog===!0?(r(),k(T,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(r(),k(N,{key:1,progress:e.progress},null,8,["progress"]))]),_:1})]),_:1}),s(S,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[Ge,e.loadingDialog===!1&&e.kb!==null?(r(),m("p",Ke,v(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)):(r(),m("div",Ue,[e.loadingDialog===!0?(r(),k(T,{key:0,variant:"tonal",size:"x-small",label:"",style:{width:"180px"}})):(r(),m("span",Ye,"-"))]))]),_:1})]),_:1}),s(S,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[Fe,u("div",null,[(e.scanner.name||"").trim()!==""?(r(),m("p",We,[d(v(e.scanner.name)+" (",1),u("code",null,v(e.scanner.endpoint),1),d(") ")])):(r(),m("code",je,v(e.scanner.endpoint),1))])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),s(C,{class:"mt-12",variant:"outlined"},{default:n(()=>[s(O,{class:"cursor-pointer",onClick:a[7]||(a[7]=l=>e.show=!e.show)},{default:n(()=>[s(W,{align:"center",justify:"space-between",class:"w-100"},{default:n(()=>[s(K,{class:"d-flex align-center"},{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-format-list-group ")]),_:1}),Xe]),_:1}),s(K,{class:"d-flex justify-end"},{default:n(()=>[s(B,{icon:e.show?"mdi-chevron-up":"mdi-chevron-down",elevation:"0"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(M),s(x,null,{default:n(()=>[ee(u("div",null,[s(M),s(de,null,{default:n(()=>[s(_,{modelValue:e.AgentGroupYaml,"onUpdate:modelValue":a[8]||(a[8]=l=>e.AgentGroupYaml=l),lang:e.editorLanguage,options:e.editorOptions,style:{"min-height":"300px"}},null,8,["modelValue","lang","options"])]),_:1})],512),[[te,e.show]])]),_:1})]),_:1}),s(C,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:n(()=>[s(O,null,{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-bug-outline ")]),_:1}),d(" Vulnerabilities "),e.totalVulnerabilities!==null?(r(),k(T,{key:0,size:"small",class:"ml-2"},{default:n(()=>[d(v(e.totalVulnerabilities),1)]),_:1})):ae("",!0)]),_:1}),s(M),s(L,{"vulnerability-preview-loading":e.vulenrabilityLoading,vulnz:e.vulns,"selected-vulnerability-key":e.selectedVulnerability!==null?e.selectedVulnerability.key:null,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnerability-preview-loading","vulnz","selected-vulnerability-key","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const ct=Y(Ie,[["render",qe],["__scopeId","data-v-91c514e7"]]);export{ct as default};
