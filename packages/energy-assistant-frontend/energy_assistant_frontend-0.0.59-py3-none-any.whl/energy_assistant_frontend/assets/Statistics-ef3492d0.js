import{C as h,D as L,c as $,t as l,u as b,w as n,m as t,I as r,W as A,H as i,G as _,J as f,E as g,N as V,r as y,Q as H,R as U,V as C,K as z,F as G,Y as J}from"./index-5a44a053.js";import{_ as K,P as Q}from"./PowerFlowCard-8cb876ae.js";import{C as N,h as W,p as E,f as F,B as M,j as P,L as j,k as I}from"./index-b30ab237.js";import{f as D}from"./utils-6f3c77d7.js";import{V as R,a as S,b as B}from"./VCard-2565a0b7.js";import{n as T}from"./transition-1df78eef.js";import{V as q,a as O}from"./VToolbar-b6309aac.js";import{a as X,V as k}from"./VTabs-c0fa38fb.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VImg-1aa5363e.js";import"./index-cc451665.js";import"./VBtn-bc6fd420.js";import"./forwardRefs-a329760c.js";import"./VProgressCircular-e11c7d5f.js";import"./resizeObserver-115493a9.js";import"./lazy-64d1df8a.js";import"./VSlideGroup-e14de701.js";const Z={class:""},x={class:"bg-subgroup mt-2 items-center rounded-md p-2"},ee={class:"text-left"},ae={class:"float-right"},te={key:0,class:"bg-subgroup mt-2 items-center rounded-md p-2"},se=h({__name:"DeviceEnergyCard",props:{measurement:{},device:{},statistics:{},timeframe:{}},setup(v){const{t:e,d:c}=L(),o=v,p=$(()=>o.measurement.consumed_energy!=0?100*o.measurement.solar_consumed_energy/o.measurement.consumed_energy:0),d=$(()=>o.statistics?{labels:o.statistics.map(s=>c(new Date(s.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Consumption",backgroundColor:"#2563eb",data:o.statistics.map(s=>{const a=s.device_measurements.find(u=>u.device_id==o.device.id);return a?a.consumed_energy:0})}]}:{labels:[],datasets:[]}),m={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};return N.register(W,E,F,M,P,j),(s,a)=>(l(),b(B,{class:"elevation-2 m-4 w-80 rounded-md p-4 sm:w-96"},{default:n(()=>[t(R,null,{default:n(()=>[r("span",{class:A(["mdi pr-2",s.device.icon])},null,2),r("span",Z,i(s.device.name),1)]),_:1}),t(S,null,{default:n(()=>[r("div",x,[r("div",ee,[_(i(f(e)("consumption"))+" ",1),r("span",ae,i(f(D)(s.measurement.consumed_energy,"kWh")),1)]),t(K,{"self-sufficiency":p.value,"consumed-energy":s.measurement.consumed_energy,"consumed-solar-energy":s.measurement.solar_consumed_energy},null,8,["self-sufficiency","consumed-energy","consumed-solar-energy"])]),s.timeframe=="week"||s.timeframe=="month"?(l(),g("div",te,[t(f(I),{data:d.value,options:m},null,8,["data"])])):V("",!0)]),_:1})]),_:1}))}}),ne=h({__name:"WeeklyStatistics",props:{data:{}},setup(v){const{d:e}=L(),c=$(()=>({labels:p.data.map(d=>e(new Date(d.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Solar Production",backgroundColor:"#fbbf24",data:p.data.map(d=>d.solar_produced_energy)},{label:"Consumption",backgroundColor:"#2563eb",data:p.data.map(d=>d.consumed_energy)}]})),o={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};N.register(W,E,F,M,P,j);const p=v;return(d,m)=>(l(),b(f(I),{data:c.value,options:o},null,8,["data"]))}}),oe=h({__name:"WeeklyStatisticsCard",props:{data:{}},setup(v){return(e,c)=>(l(),b(B,{class:"elevation-2 m-4 w-80 rounded-md p-4 sm:w-96"},{default:n(()=>[t(S,{class:"h-100 w-auto"},{default:n(()=>[t(ne,{data:e.data},null,8,["data"])]),_:1})]),_:1}))}}),re={class:"items-center p-2 mt-2 rounded-md bg-subgroup"},le={class:"text-left"},ie={class:"float-right"},de={class:"items-center p-2 mt-2 rounded-md bg-subgroup"},ue={class:"text-left"},ce={class:"float-right"},me=h({__name:"EnergyConsumptionCard",props:{selfSufficiency:{},selfConsumption:{}},setup(v){return(e,c)=>(l(),b(B,{class:"p-4 m-4 rounded-md elevation-2 w-80 sm:w-96"},{default:n(()=>[t(R,null,{default:n(()=>[_(i(e.$t("consumption")),1)]),_:1}),t(S,null,{default:n(()=>[r("div",re,[r("div",le,[_(i(e.$t("self_sufficiency"))+" ",1),r("span",ie,i(f(D)(e.selfSufficiency,"%")),1)]),t(T,{color:"sun",height:"15",rounded:"","model-value":e.selfSufficiency},null,8,["model-value"])]),r("div",de,[r("div",ue,[_(i(e.$t("self_consumption"))+" ",1),r("span",ce,i(f(D)(e.selfConsumption,"%")),1)]),t(T,{color:"grid",height:"15",rounded:"","model-value":e.selfConsumption},null,8,["model-value"])])]),_:1})]),_:1}))}}),pe={class:"flex justify-center w-full min-h-screen"},_e={key:0,class:"grid w-full grid-cols-1 justify-items-center"},fe=r("span",{class:"py-2 loading loading-dots loading-lg"},null,-1),ge=[fe],ve={key:1},ye={key:0,class:"grid grid-cols-1 p-4 lg:grid-cols-2"},Pe=h({__name:"Statistics",setup(v){const e=y(),c=y(),o=y(!1),p=y(0),d=y(0),m=y("today");H(m,()=>{const a=new Date;switch(m.value){case"week":a.setDate(a.getDate()-7);break;case"month":a.setMonth(a.getMonth()-1);break;case"year":a.setFullYear(a.getFullYear()-1);break}console.log("Load "+a.toString()),s(a)}),U(()=>{s(new Date)});const s=async function(a){o.value=!0;const u=(await C.getHomeMeasurementDifference(a,new Date)).data;e.value=u,p.value=(1-u.grid_imported_energy/u.consumed_energy)*100,d.value=(u.consumed_energy-u.grid_imported_energy)/u.solar_produced_energy*100,c.value=await C.getDailyMeasurements(a,new Date),o.value=!1};return(a,u)=>(l(),g("div",null,[t(q,{color:"transparent",title:f(J)("bp4")?a.$t("app.statistics"):""},{append:n(()=>[t(X,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=w=>m.value=w),"align-tabs":"end",height:"100%"},{default:n(()=>[t(k,{value:"today"},{default:n(()=>[_(i(a.$t("period.today")),1)]),_:1}),t(k,{value:"week"},{default:n(()=>[_(i(a.$t("period.week")),1)]),_:1}),t(k,{value:"month"},{default:n(()=>[_(i(a.$t("period.month")),1)]),_:1}),t(k,{value:"year"},{default:n(()=>[_(i(a.$t("period.year")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title"]),t(O),r("div",pe,[o.value?(l(),g("div",_e,ge)):(l(),g("div",ve,[e.value?(l(),g("div",ye,[t(Q,{"home-consumption-power":e.value.consumed_energy,"solar-power":e.value.solar_produced_energy,"grid-imported-energy":e.value.grid_imported_energy,"grid-exported-energy":e.value.grid_exported_energy,unit:"kWh"},null,8,["home-consumption-power","solar-power","grid-imported-energy","grid-exported-energy"]),t(me,{"self-sufficiency":p.value,"self-consumption":d.value},null,8,["self-sufficiency","self-consumption"]),m.value=="week"&&c.value!=null?(l(),b(oe,{key:0,data:c.value},null,8,["data"])):V("",!0),(l(!0),g(z,null,G(e.value.device_measurements,(w,Y)=>(l(),g("div",{key:Y},[t(se,{measurement:w,device:f(C).getDeviceInfo(w.device_id),statistics:c.value,timeframe:m.value},null,8,["measurement","device","statistics","timeframe"])]))),128))])):V("",!0)]))])]))}});export{Pe as default};
